options(stringsAsFactors = FALSE)
## Load Libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(rstanarm)
library(geosphere)
library(anytime)
library(weathermetrics)
library(measurements)
library(lubridate)
library(egg)
# Set Working Directory
setwd("~/Documents/git/microclimates/analyses")
# 1. Get treespotters data - and clean!
d<-read.csv("input/individual_phenometrics_data.csv", header=TRUE) ## 24 Jan 2019: 7671
# 2. Clean treespotters data first for budburst and leafout
source("cleaning/clean_TS.R") # 24 Jan 2019: 171
# 3. Clean CG data for budburst and leafout
source("cleaning/clean_CG.R") # 24 Jan 2019: 433 ### NEED TO UPDATE THE LEAF DROP INFORMATION!!!!!
# 4. Get John O'Keefe data - and clean!
ok15<-read.csv("output/okeefe2015.csv", header=TRUE)
source("cleaning/HF_datareadin.R")
# 5. Clean John O'Keefe's data for budburst and leafout data
source("cleaning/clean_HF.R") # 24 Jan 2019: 662
write.csv(d, file="output/clean_budburstandleafout.csv", row.names=FALSE)
View(d)
rm(list=ls())
options(stringsAsFactors = FALSE)
## Load Libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(rstan)
library(brms)
# Set Working Directory
setwd("~/Documents/git/microclimates/analyses")
## Data!
dvr<-read.csv("output/clean_budburstandleafout.csv", header=TRUE)
prov <- read.csv("input/provenanceinfo.csv", header=TRUE)
## Now some climate data!
source("calculating/clean_addinclimate.R")
d$mst <- NA
springtemps <- vector()
for(i in unique(cc$year)) {
springtemps <- cc$tmean[(cc$year==i & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
d$mst<- ifelse(d$year==i, mean(springtemps), d$mst)
}
d$idyear <- paste(d$id, d$year)
d$dvr.temp <- NA
dvrtemps <- vector()
for(i in c(1:nrow(d))) {
dvrtemps <- cc$tmean[(cc$doy>=d$budburst[i] & cc$doy<=d$leaves[i])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
d$dvr.temp[i]<- mean(dvrtemps)
}
rm(list=ls())
options(stringsAsFactors = FALSE)
## Load Libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(rstan)
library(brms)
# Set Working Directory
setwd("~/Documents/git/microclimates/analyses")
## Data!
dvr<-read.csv("output/clean_budburstandleafout.csv", header=TRUE)
prov <- read.csv("input/provenanceinfo.csv", header=TRUE)
## Now some climate data!
source("calculating/clean_addinclimate.R")
dvr$mst <- NA
springtemps <- vector()
for(i in unique(cc$year)) {
springtemps <- cc$tmean[(cc$year==i & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dr$year==i, mean(springtemps), dvr$mst)
}
dvr$idyear <- paste(dvr$id, dvr$year)
dvr$dvr.temp <- NA
dvrtemps <- vector()
for(i in c(1:nrow(dvr))) {
dvrtemps <- cc$tmean[(cc$doy>=dvr$budburst[i] & cc$doy<=dvr$leaves[i])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
## Now some climate data!
d <- dvr
source("calculating/clean_addinclimate.R")
dvr$mst <- NA
springtemps <- vector()
for(i in unique(cc$year)) {
springtemps <- cc$tmean[(cc$year==i & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dr$year==i, mean(springtemps), dvr$mst)
}
for(i in unique(cc$year)) {
springtemps <- cc$tmean[(cc$year==i & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==i, mean(springtemps), dvr$mst)
}
dvr$idyear <- paste(dvr$id, dvr$year)
dvr$dvr.temp <- NA
dvrtemps <- vector()
for(i in c(1:nrow(dvr))) {
dvrtemps <- cc$tmean[(cc$doy>=dvr$budburst[i] & cc$doy<=dvr$leaves[i])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
View(dvr)
for(i in c(1:nrow(dvr)))
for(i in c(1:nrow(dvr))) {
dvrtemps <- cc$tmean[(cc$doy>=dvr$budburst[i] & cc$doy<=dvr$leafout[i])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
dvr$mst <- NA
springtemps <- vector()
for(i in unique(cc$year)) {
for(j in unique(cc$climatetype))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==i & dvr$type==j, mean(springtemps), dvr$mst)
}
for(i in unique(cc$year)
)
for(j in unique(cc$climatetype))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
unique(cc$climatetype)
unique(dvr$type)
dvr$climatetype <- ifelse(dvr$type=="Treespotters" | dvr$type=="Common Garden", "weldhill", "harvardforest")
dvr$mst <- NA
springtemps <- vector()
for(i in unique(cc$year)) {
for(j in unique(cc$climatetype))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==i & dvr$climatetype==j, mean(springtemps), dvr$mst)
}
for(i in unique(cc$year))
for(j in unique(cc$climatetype))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==i & dvr$climatetype==j, mean(springtemps), dvr$mst)
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
i
j
i=2018
j="harvardforest"
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==i & dvr$climatetype==j, mean(springtemps), dvr$mst)
dvr$mst <- NA
dvr$climatetype <- ifelse(dvr$type=="Treespotters" | dvr$type=="Common Garden", "weldhill", "harvardforest")
dvr$mst <- NA
springtemps <- vector()
for(i in unique(cc$year)) {
for(j in unique(cc$climatetype))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==i & dvr$climatetype==j, mean(springtemps), dvr$mst)
}
years<-2016:2019
clims <- c("weldhill", "harvardforest")
for(i in unique(years)) {
for(j in unique(clims))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==i & dvr$climatetype==j, mean(springtemps), dvr$mst)
}
for(i in unique(years))
for(j in unique(clims))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps(dvr$year, dvr$climatetype)
springtemps <- function(year, climatetype) {
springtemps <- cc$tmean[(cc$year==year & cc$climatetype==climatetype & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==year & dvr$climatetype==climatetype, mean(springtemps), dvr$mst)
return(dvr)
}
springtemps(dvr$year, dvr$climatetype)
springtemps <- function(year, climatetype) {
springtemps <- cc$tmean[(cc$year==year & cc$climatetype==climatetype & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==year & dvr$climatetype==climatetype, mean(springtemps), dvr$mst)
return(dvr)
}
foo <- springtemps(dvr$year, dvr$climatetype)
View(foo)
foo <- springtemps(years, clims)
setwd("~/Documents/git/microclimates/analyses")
## Data!
dvr<-read.csv("output/clean_budburstandleafout.csv", header=TRUE)
prov <- read.csv("input/provenanceinfo.csv", header=TRUE)
## Now some climate data!
d <- dvr
source("calculating/clean_addinclimate.R")
dvr$climatetype <- ifelse(dvr$type=="Treespotters" | dvr$type=="Common Garden", "weldhill", "harvardforest")
dvr$risk <- dvr$leafout - dvr$budburst
dvr <- dvr[!is.na(dvr$risk),]
dvr$climatetype <- ifelse(dvr$type=="Treespotters" | dvr$type=="Common Garden", "weldhill", "harvardforest")
head(cc)
years<-2016:2019
clims <- c("weldhill", "harvardforest")
dvr$mst <- NA
springtemps <- vector()
for(i in unique(years))) {
for(j in unique(clims)))
springtemps <- cc$tmean[(cc$year[i] & cc$climatetype[j] & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year[i] & dvr$climatetype[j], mean(springtemps), dvr$mst)
}
for(i in length(unique(years))) {
for(j in length(unique(clims)))
springtemps <- cc$tmean[(cc$year[i] & cc$climatetype[j] & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year[i] & dvr$climatetype[j], mean(springtemps), dvr$mst)
}
for(i in length(unique(years))) {
for(j in length(unique(clims)))
springtemps <- cc$tmean[(cc$year[i] & cc$climatetype[j] & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year[i] && dvr$climatetype[j], mean(springtemps), dvr$mst)
}
for(j in length(unique(clims)))
for(i in length(unique(years))) {
for(j in length(unique(clims)))
springtemps <- cc$tmean[(cc$year[i] && cc$climatetype[j] & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year[i] && dvr$climatetype[j], mean(springtemps), dvr$mst)
}
i
j
for(i in length(unique(years))) {
for(j in length(unique(clims)))
cc <- cc[(cc$tmean[j]),]
springtemps <- cc$tmean[(cc$doy[i]>=60 & cc$doy[i]<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year[i] && dvr$climatetype[j], mean(springtemps), dvr$mst)
}
for(i in length(unique(years))) {
for(j in length(unique(clims)))
cc <- cc[(cc$tmean[j]),]
springtemps <- cc$tmean[(cc$doy[i]>=60 & cc$doy[i]<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year[i] & dvr$climatetype[j], mean(springtemps), dvr$mst)
}
for(i in unique(dvr$year))) {
for(j in unique(dvr$climatetype)))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==i & dvr$climatetype==j, mean(springtemps), dvr$mst)
}
for(i in unique(dvr$year)) {
for(j in unique(dvr$climatetype))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
springtemps <- springtemps[!is.na(springtemps)]
dvr$mst<- ifelse(dvr$year==i & dvr$climatetype==j, mean(springtemps), dvr$mst)
}
for(i in unique(dvr$year))
for(j in unique(dvr$climatetype))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
years<-2016:2019
clims <- c("weldhill", "harvardforest")
dvr$mst <- NA
springtemps <- vector()
for(i in unique(dvr$year)) {
for(j in unique(dvr$climatetype))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
dvr$mst<- ifelse(dvr$year==i & dvr$climatetype==j, mean(springtemps, rm.na=TRUE), dvr$mst)
}
years<-2016:2019
clims <- c("weldhill", "harvardforest")
dvr$mst <- NA
springtemps <- vector()
for(i in years) {
for(j in clims)
print(paste(i, j))
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
dvr$mst<- ifelse(dvr$year==i & dvr$climatetype==j, mean(springtemps, rm.na=TRUE), dvr$mst)
}
View(dvr)
springtemps <- cc$tmean[(cc$year==i & cc$climatetype==j & cc$doy>=60 & cc$doy<=151)] # average spring temp from March 1-May 31
for(i in years)
for(j in clims)
print(paste(i, j))
for(i in 1:years)
for(j in 1:clims)
print(paste(i, j))
years<-length(unique(2016:2019)
dvr$mst <- NA
springtemps <- vector()
for(i in 1:years)
for(j in 1:clims)
print(paste(i, j))
years<-length(unique(2016:2019)
dvr$mst <- NA
springtemps <- vector()
years<-length(unique(2016:2019)
dvr$mst <- NA
years<-length(unique(2016:2019))
clims <- c("weldhill", "harvardforest")
dvr$mst <- NA
springtemps <- vector()
for(i in 1:years)
for(j in length(clims))
print(paste(i, j))
for(i in years)
for(j in length(clims))
print(paste(i, j))
cc <- cc[(cc$tmean[i]),]
View(cc)
dvr$mst <- NA
springtemps <- vector()
for(i in c(1:nrow(dvr))) {
for(i in c(1:nrow(dvr))) {
for(i in c(1:nrow(dvr))) {
for(i in c(1:nrow(dvr))) {
for(i in c(1:nrow(dvr))) {
for(i in c(1:nrow(dvr)))
for(i in c(1:nrow(dvr))) {
dvr$dvr.temp <- NA
dvrtemps <- vector()
for(i in c(1:nrow(dvr))) {
for(j in unique(cc$climatetype))
dvrtemps <- cc$tmean[(cc$doy>=dvr$budburst[i] & cc$doy<=dvr$leafout[i] & cc$climatetype[j]==dvr$type[j])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
rm(list=ls())
rm(list=ls())
options(stringsAsFactors = FALSE)
## Load Libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(rstan)
library(brms)
# Set Working Directory
setwd("~/Documents/git/microclimates/analyses")
## Data!
dvr<-read.csv("output/clean_budburstandleafout.csv", header=TRUE)
prov <- read.csv("input/provenanceinfo.csv", header=TRUE)
## Now some climate data!
d <- dvr
source("calculating/clean_addinclimate.R")
dvr$risk <- dvr$leafout - dvr$budburst
dvr <- dvr[!is.na(dvr$risk),]
dvr$climatetype <- ifelse(dvr$type=="Treespotters" | dvr$type=="Common Garden", "weldhill", "harvardforest")
dvr$mst <- NA
springtemps <- vector()
for(i in c(1:nrow(dvr))) {
for(j in c(1:nrow(cc)))
springtemps <- ifelse(dvr$year[i]==cc$year[j] & dvr$climatetype[i]==cc$climatetype[j],
cc$tmean[(cc$doy>=60 & cc$doy<=151)], NA) # average spring temp from March 1-May 31
dvr$mst[i]<- ifelse(dvr$year[i]==cc$year[j] & dvr$climatetype[i]==cc$climatetype[j],
mean(springtemps, rm.na=TRUE), dvr$mst[i])
}
meanspring <- function(x) {
for(i in c(1:nrow(dvr))) {
for(j in c(1:nrow(cc)))
springtemps <- ifelse(dvr$year[i]==cc$year[j] & dvr$climatetype[i]==cc$climatetype[j],
cc$tmean[(cc$doy>=60 & cc$doy<=151)], NA) # average spring temp from March 1-May 31
dvr$mst[i]<- ifelse(dvr$year[i]==cc$year[j] & dvr$climatetype[i]==cc$climatetype[j],
mean(springtemps, rm.na=TRUE), dvr$mst[i])
}
return(dvr)
}
meanspring(dvr)
dvr$dvr.temp <- NA
dvrtemps <- vector()
for(i in c(1:nrow(dvr))) {
for(j in unique(cc$climatetype))
dvrtemps <- cc$tmean[(cc$doy>=dvr$budburst[i] & cc$doy<=dvr$leafout[i] & cc$climatetype[j]==dvr$type[j])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
for(i in c(1:nrow(dvr))) {
for(j in unique(cc$climatetype))
dvrtemps <- cc$tmean[(cc$doy>=dvr$budburst[i] & cc$doy<=dvr$leafout[i] & cc$climatetype[j]==dvr$climatetype[j])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
dvr$dvr.temp <- NA
dvrtemps <- vector()
for(i in c(1:nrow(dvr))) {
for(j in unique(cc$climatetype))
cc <- cc[(cc$climatetype==j),]
dvrtemps <- cc$tmean[(cc$doy>=dvr$budburst[i] & cc$doy<=dvr$leafout[i])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
for(i in c(1:nrow(dvr)))
for(j in unique(cc$climatetype))
cc <- cc[(cc$climatetype==j),]
cc
j
source("calculating/clean_addinclimate.R")
climnew <- data.frame()
for(i in c(1:nrow(dvr))) {
for(j in unique(cc$climatetype))
climnew <- cc[(cc$climatetype==j),]
dvrtemps <- climnew$tmean[(climnew$doy>=dvr$budburst[i] & climnew$doy<=dvr$leafout[i])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
dvr$idyear <- paste(dvr$id, dvr$year)
dvr$dvr.temp <- NA
dvrtemps <- vector()
climnew <- data.frame()
for(i in unique(dvr$idyear)) {
for(j in unique(cc$climatetype))
climnew <- cc[(cc$climatetype==j),]
dvrtemps <- climnew$tmean[(dvr$idyear==i & climnew$doy>=dvr$budburst & climnew$doy<=dvr$leafout)]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
dvr$dvr.temp <- NA
dvrtemps <- vector()
climnew <- data.frame()
dvrnew <- data.frame()
for(i in unique(dvr$idyear)) {
for(j in unique(cc$climatetype))
climnew <- cc[(cc$climatetype==j),]
dvrnew <- dvr[(dvr$idyear==i),]
dvrtemps <- climnew$tmean[(climnew$doy>=dvrnew$budburst & climnew$doy<=dvrnew$leafout)]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp[i]<- mean(dvrtemps)
}
for(i in unique(dvr$idyear)) {
for(j in unique(cc$climatetype))
climnew <- cc[(cc$climatetype==j),]
dvrnew <- dvr[(dvr$idyear==i),]
dvrtemps <- climnew$tmean[(climnew$doy>=dvrnew$budburst & climnew$doy<=dvrnew$leafout)]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp<- ifelse(dvr$idyear==i, mean(dvrtemps), dvr.temp)
}
for(i in unique(dvr$idyear)) {
for(j in unique(cc$climatetype))
climnew <- cc[(cc$climatetype==j),]
dvrnew <- dvr[(dvr$idyear==i),]
dvrtemps <- climnew$tmean[(climnew$doy>=dvrnew$budburst & climnew$doy<=dvrnew$leafout)]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp<- ifelse(dvr$idyear==i, mean(dvrtemps), dvr$dvr.temp)
}
climnew <- cc[(cc$climatetype==j),]
dvrnew <- dvr[(dvr$idyear==i),]
dvrtemps <- climnew$tmean[(climnew$doy>=dvrnew$budburst & climnew$doy<=dvrnew$leafout)]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
for(i in unique(dvr$idyear)) {
for(j in unique(cc$climatetype))
climnew <- cc[(cc$climatetype==j),]
dvrnew <- dvr[(dvr$idyear==i),]
dvrtemps <- climnew$tmean[(climnew$doy>=dvrnew$budburst & climnew$doy<=dvrnew$leafout)]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
if(dvrtemps==NA){
dvr$dvr.temp==dvr$dvr.temp
}
else{
dvr$dvr.temp<- ifelse(dvr$idyear==i, mean(dvrtemps), dvr$dvr.temp)
}
}
climnew <- cc[(cc$climatetype==j),]
dvrnew <- dvr[(dvr$idyear==i),]
dvrtemps <- climnew$tmean[(climnew$doy>=dvrnew$budburst & climnew$doy<=dvrnew$leafout)]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp<- ifelse(dvr$idyear==i, mean(dvrtemps), dvr$dvr.temp)
dvr$dvr.temp
climnew[j] <- cc[(cc$climatetype==j),]
for(i in length(unique(dvr$idyear))) {
for(j in length(unique(cc$climatetype)))
climnew <- cc[(length(unique(cc$climatetype))==[j]),]
dvrnew <- dvr[(length(unique(dvr$idyear))==[i]),]
dvrtemps <- climnew$tmean[(climnew$doy[j]>=dvrnew$budburst[i] & climnew$doy[j]<=dvrnew$leafout[i])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp<- ifelse(dvr$idyear==i, mean(dvrtemps), dvr$dvr.temp)
}
for(i in length(unique(dvr$idyear))) {
for(j in length(unique(cc$climatetype)))
climnew <- cc[(length(unique(cc$climatetype))==[j]),]
dvrnew <- dvr[(length(unique(dvr$idyear))==[i]),]
dvrtemps <- climnew$tmean[(climnew$doy[j]>=dvrnew$budburst[i] & climnew$doy[j]<=dvrnew$leafout[i])]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp<- ifelse(dvr$idyear==i, mean(dvrtemps), dvr$dvr.temp)
}
for(i in length(unique(dvr$idyear))) {
for(j in length(unique(cc$climatetype)))
climnew <- cc[(length(unique(cc$climatetype))==[j]),]
dvrnew <- dvr[(length(unique(dvr$idyear))==[i]),]
dvrtemps <- climnew$tmean[(climnew$doy>=dvrnew$budburst & climnew$doy<=dvrnew$leafout)]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp<- ifelse(length(unique(dvr$idyear))==i, mean(dvrtemps), dvr$dvr.temp)
}
for(i in length(unique(dvr$idyear)))
for(j in length(unique(cc$climatetype)))
climnew <- cc[(length(unique(cc$climatetype))==[j]),]
for(i in length(unique(dvr$idyear))) {
for(j in length(unique(cc$climatetype)))
climnew <- cc[(length(unique(cc$climatetype))==j),]
dvrnew <- dvr[(length(unique(dvr$idyear))==i),]
dvrtemps <- climnew$tmean[(climnew$doy>=dvrnew$budburst & climnew$doy<=dvrnew$leafout)]
dvrtemps <- dvrtemps[!is.na(dvrtemps)]
dvr$dvr.temp<- ifelse(length(unique(dvr$idyear))==i, mean(dvrtemps), dvr$dvr.temp)
}
climnew <- cc[(length(unique(cc$climatetype))==j),]
dvrnew <- dvr[(length(unique(dvr$idyear))==i),]
for(i in length(unique(dvr$idyear)))
for(j in length(unique(cc$climatetype)))
print(paste(i, j))
climnew <- cc[(cc$climatetype[j]),]
climnew
