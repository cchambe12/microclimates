## so first day of budburst for that individual for that year
doy_pheno<-bb.pheno%>%
group_by(id, phase, year) %>%
slice(which.min(doy))
doy_pheno<-doy_pheno[!duplicated(doy_pheno),]
#### Now start building a small data frame with phenophase info then add in climandpheno, chilling and photo
colstokeep<-c("genus", "species", "id","year", "phase","lat", "long", "elev", "doy")
phenos<-subset(doy_pheno, select=colstokeep)
phenos<-phenos[!duplicated(phenos),]
phenos<-phenos%>%tidyr::spread(phase, doy)
View(phenos)
phenos$fruits <- phenos$Fruits
phenos$col.leaves<-phenos$`Colored leaves`
phenos$leafdrop<-phenos$`leaf drop`
phenos <- subset(phenos, select=c("genus", "species", "id", "year", "lat", "long", "elev", "budburst",
"flowers", "fruits", "leafout", "col.leaves", "leafdrop"))
### And now last observation for when to start calculating chilling
phenos$last.obs<-ave(phenos$leafdrop, phenos$id, phenos$year, FUN=last)
phenos$last.obs<-ifelse(is.na(phenos$last.obs), ave(phenos$col.leaves, phenos$id, phenos$year, FUN=last), phenos$last.obs)
## For gdd start and chilling end
phenos$gdd.start<-46 # 15 February for each year - arbitrary, can change
### Now clean it up a bit
phenos<-phenos[!is.na(phenos$budburst),]
phenos<-phenos[!is.na(phenos$leafout),]
phenos$yr.end <- ifelse(phenos$year==2016, 366, 365)
## And now add in individual information...
phenos$type <- "Treespotters"
prov <- read.csv("output/provenanceinfo.csv", header=TRUE)
prov <- subset(prov, select= c("Individual_ID", "provenance.lat", "provenance.long"))
prov <- prov %>% rename(id=Individual_ID)
ts <- full_join(prov, phenos)
colstokeep <- c("id", "provenance.lat", "provenance.long", "genus", "species", "year", "budburst", "leafout", "yr.end", "gdd.start", "type")
d <- subset(ts, select=colstokeep)
d <- d[!is.na(d$genus),]
d$id <- as.character(d$id)
View(d)
rm(list=ls())
options(stringsAsFactors = FALSE)
## Load Libraries
library(dplyr)
library(tidyr)
library(lubridate)
# Set Working Directory
setwd("~/Documents/git/microclimates/analyses")
# 1. Get treespotters data - and clean!
d<-read.csv("input/individual_phenometrics_data.csv", header=TRUE) ## 24 Jan 2019: 7671
# 2. Clean treespotters data first for budburst and leafout
source("cleaning/clean_TS.R") # 24 Jan 2019: 171
# 3. Clean CG data for budburst and leafout
source("cleaning/clean_CG.R") # 24 Jan 2019: 433 ### NEED TO UPDATE THE LEAF DROP INFORMATION!!!!!
# 4. Get John O'Keefe data - and clean!
ok15<-read.csv("output/okeefe2015.csv", header=TRUE)
source("cleaning/HF_datareadin.R")
# 5. Clean John O'Keefe's data for budburst and leafout data
source("cleaning/clean_HF.R") # 24 Jan 2019: 662
write.csv(d, file="output/clean_budburstandleafout.csv", row.names=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
## Load Libraries
library(dplyr)
library(tidyr)
library(geosphere)
library(anytime)
library(weathermetrics)
library(measurements)
library(lubridate)
library(chillR)
# Set Working Directory
setwd("~/Documents/git/microclimates/analyses")
d <- read.csv("output/clean_budburstandleafout.csv", header=TRUE)
## Flags for question
use.hobos <- TRUE ## make false if want to use main station climate data rather than the hobo loggers
### For #1, must choose whether you want hobo logger data or main climate towers
if(use.hobos==FALSE){
# 1a. Let's add in climate data first for forcing.
source("calculating/clean_addinclimate.R") ## takes a while to load all the data, brings in climate data
#write.csv(cc, file="output/clean_addinclimate.csv", row.names=FALSE)
}
if(use.hobos==TRUE){
# 1b. Let's add in climate data from each hobo logger.
source("calculating/clean_addinclimate_loggers.R") ## takes a while to load all the data, brings in climate data
#write.csv(cc, file="output/clean_addinclimate.csv", row.names=FALSE)
}
# 2. Let's add in Forcing data first. We will use February 15 as the start
# of calculating GDD. Easy to fix if necessary in the gdd.start column
if(use.hobos==TRUE){
## Need to reset the working directory if use.hobos==TRUE.
setwd("~/Documents/git/microclimates/analyses")
}
source("calculating/calc_forceBB.R") ### Takes a long time with hobo data
# 3. Now let's add in forcing from budburst to leafout!! And also add in false spring information
source("calculating/calc_forceDVR.R") ### Takes a long time with hobo data
climandpheno<-data_frame()
days.btw<-array()
d.dvr <- d[!(d$budburst>d$leafout),]
d.dvr <- d.dvr[!is.na(d.dvr$budburst) | !is.na(d.dvr$leafout),]
days.btw <- Map(seq, d.dvr$budburst, d.dvr$leafout, by=1)
climandpheno <- data.frame(id_year_type = rep.int(d$id_year_type, vapply(days.btw, length, 1L)),
doy = do.call(c, days.btw))
View(forcebb)
climandpheno <- data.frame(id_year_type = rep.int(d.dvr$id_year_type, vapply(days.btw, length, 1L)),
doy = do.call(c, days.btw))
climandpheno <- separate(data = climandpheno, col = id_year_type, into = c("id", "year", "climatetype"), sep = "\\;")
climandpheno$id_year<-paste(climandpheno$id, climandpheno$year)
addhrs <- as.vector(unique(paste(climandpheno$id_year, climandpheno$doy)))
addhrs =
data.frame(
id_yr_day = sort(c(rep(addhrs, times=24))),
hour = sort(c(rep(seq(1:24))))
)
climandpheno <- separate(data = addhrs, col = id_yr_day, into = c("id", "year", "doy"), sep = "\\ ")
climandpheno$id <- as.character(climandpheno$id)
climandpheno$year <- as.integer(climandpheno$year)
climandpheno$doy <- as.numeric(climandpheno$doy)
climandpheno$leafout<-ave(climandpheno$doy, climandpheno$id, climandpheno$year, FUN=max) ## Warnings can be ignored - data is clean and checked
climandpheno$budburst<-ave(climandpheno$doy, climandpheno$id, climandpheno$year, FUN=min) ## Warnings can be ignored - data is clean and checked
## Add Climate data back in
cc<-dplyr::select(cc, year, doy, tmean, tmin, tmax, hour)
cc$hour <- as.numeric(cc$hour)
climandpheno<-full_join(climandpheno, cc)
climandpheno<-climandpheno[!duplicated(climandpheno),]
bb_climandpheno<-full_join(climandpheno, d.dvr)
dvr_forcing_all <- subset(bb_climandpheno, select=c("id", "doy", "year", "tmean",
"budburst", "leafout"))
dvr_forcing_all <-na.omit(dvr_forcing_all)
dvr_forcing_all <- dvr_forcing_all[(bb_forcing_all$year>2015),]
dvr_forcing_all <- dvr_forcing_all[(dvr_forcing_all$year>2015),]
dvr_forcing_all <- subset(bb_climandpheno, select=c("id", "doy", "year", "tmean",
"budburst", "leafout"))
dvr_forcing_all <-na.omit(dvr_forcing_all)
dvr_forcing_all <- dvr_forcing_all[(dvr_forcing_all$year>2015),]
dvr_forcing_all$indyear <- paste(dvr_forcing_all$id, dvr_forcing_all$year, sep=";")
dvr_forcing_all$indyrnum <- as.numeric(as.factor(dvr_forcing_all$indyear))
indsyrlist <- length(unique(dvr_forcing_all$indyrnum))
hourtemps <- data.frame()
dvr_forcing_all$gdd_dvr <- NA
dvr_forcing_all$fs.count <- NA
for(i in 1:indsyrlist){ #i=2
hourtemps <- subset(dvr_forcing_all[(dvr_forcing_all$indyrnum==i),], select=c("year", "doy", "tmean"))
hourtemps <- hourtemps[order(hourtemps$doy),]
hourtemps$tmean <- ave(hourtemps$tmean, hourtemps$doy)
hourtemps <- hourtemps[!duplicated(hourtemps),]
hourtemps$gddcalc <- ifelse(hourtemps$tmean>0, hourtemps$tmean, 0)
hourtemps$gdd_dvr <- ave(hourtemps$gddcalc, FUN=sum)
hourtemps$fs <- ifelse(hourtemps$tmean<=-2.2, 1, 0)
hourtemps$fs.count <- ave(hourtemps$fs, FUN=sum)
dvr_forcing_all[which(dvr_forcing_all$indyrnum==i), 9] <- unique(hourtemps$gdd_dvr)
dvr_forcing_all[which(dvr_forcing_all$indyrnum==i), 10] <- unique(hourtemps$fs.count)
}
forcedvr <- subset(dvr_forcing_all, select=c("id", "year", "budburst", "leafout", "gdd_dvr", "fs.count"))
forcedvr <- forcedvr[!duplicated(forcedvr),]
force <- full_join(forcebb, forcedvr)
gdd.stan <- full_join(d, force)
if(use.hobos==TRUE){
## If using 1b)...
write.csv(gdd.stan, file="output/clean_gdd_bbanddvr_hobo.csv", row.names = FALSE)
}
rm(list=ls())
options(stringsAsFactors = FALSE)
## Load Libraries
library(dplyr)
library(tidyr)
library(geosphere)
library(anytime)
library(weathermetrics)
library(measurements)
library(lubridate)
library(chillR)
# Set Working Directory
setwd("~/Documents/git/microclimates/analyses")
d <- read.csv("output/clean_budburstandleafout.csv", header=TRUE)
## Flags for question
use.hobos <- FALSE ## make false if want to use main station climate data rather than the hobo loggers
if(use.hobos==FALSE){
# 1a. Let's add in climate data first for forcing.
source("calculating/clean_addinclimate.R") ## takes a while to load all the data, brings in climate data
#write.csv(cc, file="output/clean_addinclimate.csv", row.names=FALSE)
}
if(use.hobos==TRUE){
# 1b. Let's add in climate data from each hobo logger.
source("calculating/clean_addinclimate_loggers.R") ## takes a while to load all the data, brings in climate data
#write.csv(cc, file="output/clean_addinclimate.csv", row.names=FALSE)
}
# 2. Let's add in Forcing data first. We will use February 15 as the start
# of calculating GDD. Easy to fix if necessary in the gdd.start column
if(use.hobos==TRUE){
## Need to reset the working directory if use.hobos==TRUE.
setwd("~/Documents/git/microclimates/analyses")
}
source("calculating/calc_forceBB.R") ### Takes a long time with hobo data
# 3. Now let's add in forcing from budburst to leafout!! And also add in false spring information
source("calculating/calc_forceDVR.R") ### Takes a long time with hobo data
if(use.hobos==FALSE){
## If using 1a)...
write.csv(gdd.stan, file="output/clean_gdd_bbanddvr.csv", row.names = FALSE)
}
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(ggplot2)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
## Load the data
gdd.stan <- read.csv("output/gdd_clean_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/gdd_clean_bbanddvr_hobo.csv", header=TRUE)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
gdd.hobo <- read.csv("output/gdd_clean_bbanddvr_hobo.csv", header=TRUE)
## Load the data
gdd.stan <- read.csv("output/clean_gdd_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv", header=TRUE)
gdd.hobo$gdd_bb_hobo <- gdd.hobo$gdd_bb
gdd.hobo$gdd_dvr_hobo <- gdd.hobo$gdd_dvr
gdd.hobo$gdd_bb <- NULL
gdd.hobo$gdd_dvr <- NULL
goo <- full_join(gdd.stan, gdd.hobo)
View(goo)
commoncols <- c("id", "provenance.lat", "spp",
"gdd_bb", "gdd_dvr", "gdd_bb_hobo", "gdd_dvr_hobo", "fs.count", "year", "budburst")
gdd.hobo <- subset(gdd.hobo, select=commoncols)
commoncols <- c("id", "provenance.lat", "spp", "fs.count", "year", "budburst")
gdd.hobo <- subset(gdd.hobo, select=c(commoncols, "gdd_bb_hobo", "gdd_dvr_hobo"))
View(gdd.hobo)
commoncols <- c("id", "provenance.lat", "fs.count", "year", "budburst")
gdd.hobo <- subset(gdd.hobo, select=c(commoncols, "gdd_bb_hobo", "gdd_dvr_hobo"))
gdd.stan <- subset(gdd.stan, select=c(commoncols, "gdd_bb", "gdd_dvr"))
gdd <- full_join(gdd.stan, gdd.hobo)
gdd <- gdd[(gdd$gdd_bb<=1000),]
gdd <- gdd[(gdd$gdd_bb_hobo<=1000),]
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
gdd <- gdd[(gdd$year==2019),]
View(gdd)
gdd$gddmean <- ave(gdd$gdd_bb, gdd$spp, gdd$site)
gdd$gddsd <- ave(gdd$gdd_bb, gdd$spp, gdd$site, gdd$year, FUN=sd)
gddplot <- na.omit(gdd)
gddplot$gddmean <- ave(gddplot$gdd_bb, gddplot$spp)
View(gddplot)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
## Load the data
gdd.stan <- read.csv("output/clean_gdd_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv", header=TRUE)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(ggplot2)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
## Load the data
gdd.stan <- read.csv("output/clean_gdd_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv", header=TRUE)
gdd.hobo$gdd_bb_hobo <- gdd.hobo$gdd_bb
gdd.hobo$gdd_dvr_hobo <- gdd.hobo$gdd_dvr
gdd.hobo$gdd_bb <- NULL
gdd.hobo$gdd_dvr <- NULL
View(gdd.hobo)
gdd.hobo$spp <- paste(substr(gdd.hobo$genus, 0, 3), substr(gdd.hobo$species, 0, 3), sep="")
gdd.stan$spp <- paste(substr(gdd.stan$genus, 0, 3), substr(gdd.stan$species, 0, 3), sep="")
commoncols <- c("id", "provenance.lat", "fs.count", "year", "budburst", "spp")
gdd.hobo <- subset(gdd.hobo, select=c(commoncols, "gdd_bb_hobo", "gdd_dvr_hobo"))
gdd.stan <- subset(gdd.stan, select=c(commoncols, "gdd_bb", "gdd_dvr"))
gdd <- full_join(gdd.stan, gdd.hobo)
gdd <- gdd[(gdd$year==2019),]
gdd <- gdd[(gdd$gdd_bb<=1000),]
gdd <- gdd[(gdd$gdd_bb_hobo<=1000),]
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
gddplot <- na.omit(gdd)
gddplot$gddmean <- ave(gddplot$gdd_bb, gddplot$spp)
gddplot$gddsd <- ave(gddplot$gdd_bb, gddplot$spp, FUN=sd)
gddplot$ymin <- gddplot$gddmean-gddplot$gddsd
gddplot$ymax <- gddplot$gddmean+gddplot$gddsd
goo <- gather(gddplot, "gdd", "method", -id, -provenance.lat, -fs.count, -year, -budburst, -spp)
View(goo)
gddplot <- gather(gddplot, "method", "gdd", -id, -provenance.lat, -fs.count, -year, -budburst, -spp)
gddplot$gddmean <- ave(gddplot$gdd, gddplot$spp, gddplot$method)
gddplot$gddsd <- ave(gddplot$gdd_bb, gddplot$spp, gddplot$method, FUN=sd)
gddplot$gddsd <- ave(gddplot$gdd, gddplot$spp, gddplot$method, FUN=sd)
gddplot$ymin <- gddplot$gddmean-gddplot$gddsd
gddplot$ymax <- gddplot$gddmean+gddplot$gddsd
gddbar <- ggplot(gddplot, aes(x=spp, y=gddmean, fill=method)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing Degree Days to BB") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) #+
quartz()
gddbar
View(gddplot)
gddplot <- na.omit(gddplot)
gddbar <- ggplot(gddplot, aes(x=spp, y=gddmean, fill=method)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing Degree Days to BB") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) #+
gddbar
unique(gddplot$method)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(ggplot2)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
## Load the data
gdd.stan <- read.csv("output/clean_gdd_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv", header=TRUE)
gdd.hobo$gdd_bb_hobo <- gdd.hobo$gdd_bb
gdd.hobo$gdd_dvr_hobo <- gdd.hobo$gdd_dvr
gdd.hobo$gdd_bb <- NULL
gdd.hobo$gdd_dvr <- NULL
gdd.hobo$spp <- paste(substr(gdd.hobo$genus, 0, 3), substr(gdd.hobo$species, 0, 3), sep="")
gdd.stan$spp <- paste(substr(gdd.stan$genus, 0, 3), substr(gdd.stan$species, 0, 3), sep="")
commoncols <- c("id", "provenance.lat", "fs.count", "year", "budburst", "spp")
gdd.hobo <- subset(gdd.hobo, select=c(commoncols, "gdd_bb_hobo", "gdd_dvr_hobo"))
gdd.stan <- subset(gdd.stan, select=c(commoncols, "gdd_bb", "gdd_dvr"))
gdd <- full_join(gdd.stan, gdd.hobo)
gdd <- gdd[(gdd$year==2019),]
gdd <- gdd[(gdd$gdd_bb<=1000),]
gdd <- gdd[(gdd$gdd_bb_hobo<=1000),]
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
gddplot <- na.omit(gdd)
gddplot <- gather(gddplot, "method", "gdd", -id, -provenance.lat, -fs.count, -year, -budburst, -spp)
gddplot$gddmean <- ave(gddplot$gdd, gddplot$spp, gddplot$method)
gddplot$gddsd <- ave(gddplot$gdd, gddplot$spp, gddplot$method, FUN=sd)
gddplot$ymin <- gddplot$gddmean-gddplot$gddsd
gddplot$ymax <- gddplot$gddmean+gddplot$gddsd
View(gddplot)
gddplot <- na.omit(gddplot)
gddbar <- ggplot(gddplot, aes(x=spp, y=gddmean, fill=method)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing Degree Days to BB") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) #+
gddbar
unique(gddplot$method)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(ggplot2)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
## Load the data
gdd.stan <- read.csv("output/clean_gdd_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv", header=TRUE)
gdd.hobo$gdd_bb_hobo <- gdd.hobo$gdd_bb
gdd.hobo$gdd_dvr_hobo <- gdd.hobo$gdd_dvr
gdd.hobo$gdd_bb <- NULL
gdd.hobo$gdd_dvr <- NULL
gdd.hobo$spp <- paste(substr(gdd.hobo$genus, 0, 3), substr(gdd.hobo$species, 0, 3), sep="")
gdd.stan$spp <- paste(substr(gdd.stan$genus, 0, 3), substr(gdd.stan$species, 0, 3), sep="")
commoncols <- c("id", "provenance.lat", "fs.count", "year", "budburst", "spp")
gdd.hobo <- subset(gdd.hobo, select=c(commoncols, "gdd_bb_hobo"))
gdd.stan <- subset(gdd.stan, select=c(commoncols, "gdd_bb"))
gdd <- full_join(gdd.stan, gdd.hobo)
gdd <- gdd[(gdd$year==2019),]
gdd <- gdd[(gdd$gdd_bb<=1000),]
gdd <- gdd[(gdd$gdd_bb_hobo<=1000),]
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
gddplot <- na.omit(gdd)
gddplot <- gather(gddplot, "method", "gdd", -id, -provenance.lat, -fs.count, -year, -budburst, -spp)
gddplot$gddmean <- ave(gddplot$gdd, gddplot$spp, gddplot$method)
gddplot$gddsd <- ave(gddplot$gdd, gddplot$spp, gddplot$method, FUN=sd)
gddplot$ymin <- gddplot$gddmean-gddplot$gddsd
gddplot$ymax <- gddplot$gddmean+gddplot$gddsd
gddplot <- na.omit(gddplot)
gddbar <- ggplot(gddplot, aes(x=spp, y=gddmean, fill=method)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing Degree Days to BB") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) #+
#geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
#geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed")  +
#scale_linetype_manual(name="Site", values=c(1, 2, 3), labels=c("arb", "cg", "hf")) #+
#guides(fill=FALSE)
#ggtitle("A. Four weeks chilling")  + coord_cartesian(xlim=c(1, 8), ylim=c(-5,85), expand=TRUE)
gddbar
View(gdd)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(ggplot2)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
## Load the data
gdd.stan <- read.csv("output/clean_gdd_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv", header=TRUE)
gdd.hobo$gdd_bb_hobo <- gdd.hobo$gdd_bb
gdd.hobo$gdd_dvr_hobo <- gdd.hobo$gdd_dvr
gdd.hobo$gdd_bb <- NULL
gdd.hobo$gdd_dvr <- NULL
gdd.hobo$spp <- paste(substr(gdd.hobo$genus, 0, 3), substr(gdd.hobo$species, 0, 3), sep="")
gdd.stan$spp <- paste(substr(gdd.stan$genus, 0, 3), substr(gdd.stan$species, 0, 3), sep="")
commoncols <- c("id", "provenance.lat", "fs.count", "year", "budburst", "spp")
gdd.hobo <- subset(gdd.hobo, select=c(commoncols, "gdd_dvr_hobo"))
gdd.stan <- subset(gdd.stan, select=c(commoncols, "gdd_dvr"))
gdd <- full_join(gdd.stan, gdd.hobo)
gdd <- gdd[(gdd$year==2019),]
gdd <- gdd[(gdd$gdd_bb<=1000),]
gdd <- gdd[(gdd$gdd_bb_hobo<=1000),]
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
gddplot <- na.omit(gdd)
gddplot <- gather(gddplot, "method", "gdd", -id, -provenance.lat, -fs.count, -year, -budburst, -spp)
gddplot$gddmean <- ave(gddplot$gdd, gddplot$spp, gddplot$method)
gddplot$gddsd <- ave(gddplot$gdd, gddplot$spp, gddplot$method, FUN=sd)
gddplot$ymin <- gddplot$gddmean-gddplot$gddsd
gddplot$ymax <- gddplot$gddmean+gddplot$gddsd
gddplot <- na.omit(gddplot)
gddbar <- ggplot(gddplot, aes(x=spp, y=gddmean, fill=method)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing Degree Days between Leafout and Budburst") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) #+
quartz()
gddbar
gdd <- full_join(gdd.stan, gdd.hobo)
gdd <- gdd[(gdd$year==2019),]
gdd <- gdd[(gdd$gdd_dvr<=1000),]
gdd <- gdd[(gdd$gdd_dvr_hobo<=1000),]
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
gddplot <- na.omit(gdd)
gddplot <- gather(gddplot, "method", "gdd", -id, -provenance.lat, -fs.count, -year, -budburst, -spp)
gddplot$gddmean <- ave(gddplot$gdd, gddplot$spp, gddplot$method)
gddplot$gddsd <- ave(gddplot$gdd, gddplot$spp, gddplot$method, FUN=sd)
gddplot$ymin <- gddplot$gddmean-gddplot$gddsd
gddplot$ymax <- gddplot$gddmean+gddplot$gddsd
gddplot <- na.omit(gddplot)
gddbar <- ggplot(gddplot, aes(x=spp, y=gddmean, fill=method)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing Degree Days between Leafout and Budburst") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) #+
gddbar
gdd$gdd.diff <- gdd$gdd_dvr_hobo - gdd$gdd_dvr
unique(gdd$gdd.diff)
hist(gdd$gdd.diff)
mean(gdd$gdd.diff)
mean(gdd$gdd.diff, na.rm = TRUE)
range(gdd$gdd.diff, na.rm = TRUE)
sd(gdd$gdd.diff, na.rm = TRUE)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(ggplot2)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
## Load the data
gdd.stan <- read.csv("output/clean_gdd_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv", header=TRUE)
gdd.hobo$gdd_bb_hobo <- gdd.hobo$gdd_bb
gdd.hobo$gdd_dvr_hobo <- gdd.hobo$gdd_dvr
gdd.hobo$gdd_bb <- NULL
gdd.hobo$gdd_dvr <- NULL
gdd.hobo$spp <- paste(substr(gdd.hobo$genus, 0, 3), substr(gdd.hobo$species, 0, 3), sep="")
gdd.stan$spp <- paste(substr(gdd.stan$genus, 0, 3), substr(gdd.stan$species, 0, 3), sep="")
commoncols <- c("id", "provenance.lat", "fs.count", "year", "budburst", "spp")
gdd.hobo <- subset(gdd.hobo, select=c(commoncols, "gdd_bb_hobo"))
gdd.stan <- subset(gdd.stan, select=c(commoncols, "gdd_bb"))
gdd <- full_join(gdd.stan, gdd.hobo)
gdd <- gdd[(gdd$year==2019),]
gdd <- gdd[(gdd$gdd_bb<=1000),]
gdd <- gdd[(gdd$gdd_bb_hobo<=1000),]
#gdd$gdd.diff <- gdd$gdd_dvr_hobo - gdd$gdd_dvr ## mean = 4.81; range=c(-1.24, 13.97); sd=3.82
gdd$gdd.diff <- gdd$gdd_bb_hobo - gdd$gdd_bb
mean(gdd$gdd.diff, na.rm=TRUE)
range(gdd$gdd.diff, na.rm=TRUE)
sd(gdd$gdd.diff, na.rm=TRUE)
