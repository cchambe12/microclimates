legend.text.align = 0,
legend.position = "none",
legend.key = element_rect(colour = "transparent", fill = "white")) +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Belowground Biomass (control)") +
ylab("Belowground Biomass (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots6$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
#scale_size_continuous(name=expression(Delta*" in false spring risk")) +
scale_y_continuous(breaks=seq(-1, 1,.10)) +
scale_x_continuous(breaks=seq(-1, 1,.10)) +
coord_cartesian(xlim=c(-1,1), ylim=c(-1, 1), expand=TRUE) + #guides(col=FALSE) +
ggtitle("B. Six weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshoots8 <- ggplot(chillrootstoshoots8, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position="none",
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.box="horizontal") +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Belowground Biomass (control)") +
ylab("Belowground Biomass (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots8$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
scale_y_continuous(breaks=seq(-1, 1,.10)) +
scale_x_continuous(breaks=seq(-1, 1,.10)) +
coord_cartesian(xlim=c(-1,1), ylim=c(-1, 1), expand=TRUE) + #guides(col=FALSE) +
ggtitle("C. Eight weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshootsplot<-grid.arrange(rootstoshoots4, rootstoshoots6, rootstoshoots8, ncol=3)
rootstoshoots4 <- ggplot(chillrootstoshoots4, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.position = c(0.825, .125),
legend.background = element_blank(),
legend.box.background = element_rect(colour = "black"),
legend.title = element_text(size=7),
legend.text = element_text(size=6),
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.key.size = unit(0.3, "cm")) +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Belowground Biomass (control)") +
ylab("Belowground Biomass (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots4$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
#scale_size_continuous(name=expression(Delta*" in false spring risk")) +
scale_y_continuous(breaks=seq(-10, 10,.10)) +
scale_x_continuous(breaks=seq(-10, 10,.10)) +
coord_cartesian(xlim=c(-10,10), ylim=c(-10, 10), expand=TRUE) + #guides(col=FALSE) +
ggtitle("A. Four weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshoots6 <- ggplot(chillrootstoshoots6, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position = "none",
legend.key = element_rect(colour = "transparent", fill = "white")) +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Belowground Biomass (control)") +
ylab("Belowground Biomass (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots6$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
#scale_size_continuous(name=expression(Delta*" in false spring risk")) +
scale_y_continuous(breaks=seq(-10, 10,.10)) +
scale_x_continuous(breaks=seq(-10, 10,.10)) +
coord_cartesian(xlim=c(-10,10), ylim=c(-10, 10), expand=TRUE) + #guides(col=FALSE) +
ggtitle("B. Six weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshoots8 <- ggplot(chillrootstoshoots8, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position="none",
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.box="horizontal") +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Belowground Biomass (control)") +
ylab("Belowground Biomass (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots8$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
scale_y_continuous(breaks=seq(-10, 10,.10)) +
scale_x_continuous(breaks=seq(-10, 10,.10)) +
coord_cartesian(xlim=c(-10,10), ylim=c(-10, 10), expand=TRUE) + #guides(col=FALSE) +
ggtitle("C. Eight weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshootsplot<-grid.arrange(rootstoshoots4, rootstoshoots6, rootstoshoots8, ncol=3)
rootstoshoots4 <- ggplot(chillrootstoshoots4, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.position = c(0.825, .125),
legend.background = element_blank(),
legend.box.background = element_rect(colour = "black"),
legend.title = element_text(size=7),
legend.text = element_text(size=6),
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.key.size = unit(0.3, "cm")) +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Belowground Biomass (control)") +
ylab("Belowground Biomass (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots4$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
#scale_size_continuous(name=expression(Delta*" in false spring risk")) +
scale_y_continuous(breaks=seq(0, 5,1)) +
scale_x_continuous(breaks=seq(0, 5,1)) +
coord_cartesian(xlim=c(0,5), ylim=c(0, 5), expand=TRUE) + #guides(col=FALSE) +
ggtitle("A. Four weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshoots6 <- ggplot(chillrootstoshoots6, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position = "none",
legend.key = element_rect(colour = "transparent", fill = "white")) +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Belowground Biomass (control)") +
ylab("Belowground Biomass (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots6$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
#scale_size_continuous(name=expression(Delta*" in false spring risk")) +
scale_y_continuous(breaks=seq(0, 5,1)) +
scale_x_continuous(breaks=seq(0, 5,1)) +
coord_cartesian(xlim=c(0,5), ylim=c(0, 5), expand=TRUE) + #guides(col=FALSE) +
ggtitle("B. Six weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshoots8 <- ggplot(chillrootstoshoots8, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position="none",
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.box="horizontal") +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Belowground Biomass (control)") +
ylab("Belowground Biomass (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots8$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
scale_y_continuous(breaks=seq(0, 5,1)) +
scale_x_continuous(breaks=seq(0, 5,1)) +
coord_cartesian(xlim=c(0,5), ylim=c(0, 5), expand=TRUE) + #guides(col=FALSE) +
ggtitle("C. Eight weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshootsplot<-grid.arrange(rootstoshoots4, rootstoshoots6, rootstoshoots8, ncol=3)
rootstoshoots4 <- ggplot(chillrootstoshoots4, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.position = c(0.825, .125),
legend.background = element_blank(),
legend.box.background = element_rect(colour = "black"),
legend.title = element_text(size=7),
legend.text = element_text(size=6),
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.key.size = unit(0.3, "cm")) +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Root to shoot ratio (control)") +
ylab("Root to shoot ratio (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots4$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
#scale_size_continuous(name=expression(Delta*" in false spring risk")) +
scale_y_continuous(breaks=seq(0, 4,1)) +
scale_x_continuous(breaks=seq(0, 4,1)) +
coord_cartesian(xlim=c(0,5), ylim=c(0, 5), expand=TRUE) + #guides(col=FALSE) +
ggtitle("A. Four weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshoots6 <- ggplot(chillrootstoshoots6, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position = "none",
legend.key = element_rect(colour = "transparent", fill = "white")) +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Root to shoot ratio (control)") +
ylab("Root to shoot ratio (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots6$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
#scale_size_continuous(name=expression(Delta*" in false spring risk")) +
scale_y_continuous(breaks=seq(0, 4,1)) +
scale_x_continuous(breaks=seq(0, 4,1)) +
coord_cartesian(xlim=c(0,5), ylim=c(0, 5), expand=TRUE) + #guides(col=FALSE) +
ggtitle("B. Six weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshoots8 <- ggplot(chillrootstoshoots8, aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean, col=bbtype), alpha=2) +
geom_point(aes(x=rootstoshootscontmean, y=rootstoshootsfrzmean), shape=3) +
geom_linerange(aes(ymin=ymin, ymax=ymax), alpha=0.3) +
geom_errorbarh(aes(xmin = xmin, xmax = xmax, height = 0), alpha=0.3) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position="none",
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.box="horizontal") +
#geom_text(aes(label=species.name), vjust=-1, fontface="italic", size=3, position=position_jitter(width=0.5,height=0.5)) +
xlab("Root to shoot ratio (control)") +
ylab("Root to shoot ratio (treatment)") +
scale_color_manual(name="Budburst timing", values=cols,
labels=chillrootstoshoots8$bbtype) +
#scale_size_manual(name=expression("Change in duration of \nvegetative risk (days)"), values=valsize,
#                 labels=sizes) +
scale_y_continuous(breaks=seq(0, 4,1)) +
scale_x_continuous(breaks=seq(0, 4,1)) +
coord_cartesian(xlim=c(0,5), ylim=c(0, 5), expand=TRUE) + #guides(col=FALSE) +
ggtitle("C. Eight weeks chilling") + geom_abline(intercept = 0, slope = 1, col="grey")
rootstoshootsplot<-grid.arrange(rootstoshoots4, rootstoshoots6, rootstoshoots8, ncol=3)
rm(list=ls())
options(stringsAsFactors = FALSE)
#### Questions to address:
## Compare GDDs between hobo loggers and weather station data
# 1) GDDlo ~ 1 + (1|species) - do once for HF weather station, once for hobo logger and repeat for Arboretum
# Compare urban effect using weather station data and then hobo logger data
# 2) GDDlo ~ urban + (urban|species) - do once with weather station data and once with hobo logger data
## Let's start with Question 1 first...
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
## Let's load some real data to check out.
setwd("~/Documents/git/microclimates/analyses/")
source("source/stan_utility.R")
ws <- read.csv("output/fakedata_ws.csv")
hobo <- read.csv("output/fakedata_hl.csv")
################################################################################################
################################ URBAN MODELS NOW!! ############################################
################################################################################################
ws_urb <- read.csv("output/fakedata_ws_urb.csv")
hobo_urb <- read.csv("output/fakedata_hl_urb.csv")
datalist.wsurb <- with(ws_urb,
list(y = gdd,
tx = urban,
sp = as.numeric(as.factor(species)),
N = nrow(ws_urb),
n_sp = length(unique(ws_urb$species))
)
)
ws_urb_fake = stan('stan/urbanmodel_stan_normal_weather.stan', data = datalist.wsurb,
iter = 5000, warmup=2000, control=list(max_treedepth = 15,adapt_delta = 0.99)) ###
check_all_diagnostics(ws_urb_fake)
ws_urb_fake.sum <- summary(ws_urb_fake)$summary
ws_urb_fake.sum[grep("mu_", rownames(ws_urb_fake.sum)),]
ws_urb_fake.sum[grep("sigma_", rownames(ws_urb_fake.sum)),]
ws_urb_fake = stan('stan/urbanmodel_stan_normal_weather.stan', data = datalist.wsurb,
iter = 5000, warmup=2000, control=list(max_treedepth = 15,adapt_delta = 0.99)) ###
check_all_diagnostics(ws_urb_fake)
ws_urb_fake.sum <- summary(ws_urb_fake)$summary
ws_urb_fake.sum[grep("mu_", rownames(ws_urb_fake.sum)),]
ws_urb_fake.sum[grep("sigma_", rownames(ws_urb_fake.sum)),]
library(brms)
get_prior(gdd ~ urban + (urban | species), data=ws_urb)
ws_urb_brm <- brm(gdd ~ urban + (urban | species), data=ws_urb,
iter=5000, warmup=10500, chains=2,
control=list(max_treedepth=15, adapt_delta=0.99),
prior = prior(normal(400, 100), class=Intercept) +
prior(normal(0, 100), class=b) +
prior(normal(0, 100), class=sigma))
ws_urb_brm <- brm(gdd ~ urban + (urban | species), data=ws_urb,
iter=5000, warmup=1000, chains=2,
control=list(max_treedepth=15, adapt_delta=0.99),
prior = prior(normal(400, 100), class=Intercept) +
prior(normal(0, 100), class=b) +
prior(normal(0, 100), class=sigma))
datalist.hlurb <- with(hobo_urb,
list(y = gdd,
tx = urban,
sp = as.numeric(as.factor(species)),
N = nrow(hobo_urb),
n_sp = length(unique(hobo_urb$species))
)
)
hl_urb_fake = stan('stan/urbanmodel_stan_normal_hobo.stan', data = datalist.hlurb,
iter = 5000, warmup=2000, control=list(max_treedepth = 15,adapt_delta = 0.99)) ###
# housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
## Let's start with Question 1 first...
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
## Let's load some real data to check out.
setwd("~/Documents/git/microclimates/analyses/")
source("source/stan_utility.R")
ws <- read.csv("output/fakedata_ws.csv")
hobo <- read.csv("output/fakedata_hl.csv")
################################################################################################
################################ URBAN MODELS NOW!! ############################################
################################################################################################
ws_urb <- read.csv("output/fakedata_ws_urb.csv")
hobo_urb <- read.csv("output/fakedata_hl_urb.csv")
datalist.wsurb <- with(ws_urb,
list(y = gdd,
tx = urban,
sp = as.numeric(as.factor(species)),
N = nrow(ws_urb),
n_sp = length(unique(ws_urb$species))
)
)
datalist.hlurb <- with(hobo_urb,
list(y = gdd,
tx = urban,
sp = as.numeric(as.factor(species)),
N = nrow(hobo_urb),
n_sp = length(unique(hobo_urb$species))
)
)
hl_urb_fake = stan('stan/urbanmodel_stan_normal_hobo.stan', data = datalist.hlurb,
iter = 5000, warmup=2000, control=list(max_treedepth = 15,adapt_delta = 0.99)) ###
check_all_dia0gnostics(hl_urb_fake)
check_all_diagnostics(hl_urb_fake)
hl_urb_fake.sum <- summary(hl_urb_fake)$summary
hl_urb_fake.sum[grep("mu_", rownames(hl_urb_fake.sum)),]
hl_urb_fake.sum[grep("sigma_", rownames(hl_urb_fake.sum)),]
launch_shinystan(hl_urb_fake)
ws_urb <- read.csv("output/clean_gdd_bbanddvr.csv")
hobo_urb <- read.csv("output/clean_gdd_bbanddvr_hobo.csv")
ws_urb$urban <- NA
ws_urb$urban <- ifelse(ws_urb$type=="Harvard Forest", 0, ws_urb$urban)
ws_urb$urban <- ifelse(ws_urb$type=="Treespotters", 1, ws_urb$urban)
View(ws_urb)
ws_urb.stan <- subset(ws_urb, select=c(gdd_bb, urban, genus, species))
ws_urb.stan <- ws_urb.stan[(complete.cases(ws_urb.stan)),]
ws_urb.stan$spp <- paste(ws_urb.stan$genus, ws_urb.stan$species, sep="_")
ws_urb.stan <- ws_urb.stan[(ws_urb.stan$gdd_bb<=1000),]
datalist.wsurb <- with(ws_urb.stan,
list(y = gdd_bb,
tx = urban,
sp = as.numeric(as.factor(spp)),
N = nrow(ws_urb.stan),
n_sp = length(unique(ws_urb.stan$spp))
)
)
wsall_urb_mod = stan('stan/urbanmodel_stan_normal_weather.stan', data = datalist.wsurb,
iter = 5000, warmup=2000, control=list(max_treedepth = 15,adapt_delta = 0.99)) ###
#check_all_diagnostics(ws_urb_mod)
check_all_diagnostics(wsall_urb_mod)
wsall_urb_mod.sum <- summary(wsall_urb_mod)$summary
wsall_urb_mod.sum[grep("mu_", rownames(wsall_urb_mod.sum)),]
wsall_urb_mod.sum[grep("sigma_", rownames(wsall_urb_mod.sum)),]
my.pal <- rep(brewer.pal(n = 10, name = "Paired"), 4)
my.pch <- rep(15:18, each=10)
plot(gdd_bb ~ as.numeric(as.factor(spp)), col=my.pal[as.factor(spp)], pch=my.pch[as.factor(spp)], data = ws_urb.stan)
abline(h=mean(ws_urb.stan$gdd), lwd=3)
plot(density(ws_urb.stan$gdd))
abline(v = mean(ws_urb.stan$gdd), lwd = 2, col = "blue")
save(wsall_urb_mod, file="~/Documents/git/microclimates/analyses/stan/wsall_urban_mod.Rdata")
hobo_urb <- read.csv("output/clean_gdd_bbanddvr_hobo.csv")
hobo_urb$urban <- NA
hobo_urb$urban <- ifelse(hobo_urb$type=="Harvard Forest", 0, hobo_urb$urban)
hobo_urb$urban <- ifelse(hobo_urb$type=="Treespotters", 1, hobo_urb$urban)
hobo_urb.stan <- subset(hobo_urb, select=c(gdd_bb, urban, genus, species))
hobo_urb.stan <- hobo_urb.stan[(complete.cases(hobo_urb.stan)),]
hobo_urb.stan$spp <- paste(hobo_urb.stan$genus, hobo_urb.stan$species, sep="_")
hobo_urb.stan <- hobo_urb.stan[(hobo_urb.stan$gdd_bb<=1000),]
datalist.hobourb <- with(hobo_urb.stan,
list(y = gdd_bb,
tx = urban,
sp = as.numeric(as.factor(spp)),
N = nrow(hobo_urb.stan),
n_sp = length(unique(hobo_urb.stan$spp))
)
)
hobo_urb_mod = stan('stan/urbanmodel_stan_normal_hobo.stan', data = datalist.hobourb,
iter = 5000, warmup=2000, control=list(max_treedepth = 15,adapt_delta = 0.99)) ###
check_all_diagnostics(hobo_urb_mod)
hobo_urb_mod.sum <- summary(hobo_urb_mod)$summary
hobo_urb_mod.sum[grep("mu_", rownames(hobo_urb_mod.sum)),]
hobo_urb_mod.sum[grep("sigma_", rownames(hobo_urb_mod.sum)),]
wsall_urb_mod.sum[grep("mu_", rownames(wsall_urb_mod.sum)),]
wsall_urb_mod.sum[grep("sigma_", rownames(wsall_urb_mod.sum)),]
save(hobo_urb_mod, file="~/Documents/git/microclimates/analyses/stan/hobo_urban_mod.Rdata")
rm(list=ls())
options(stringsAsFactors = FALSE)
#### Questions to address:
## Compare GDDs between hobo loggers and weather station data
# 1) GDDlo ~ 1 + (1|species) - do once for HF weather station, once for hobo logger and repeat for Arboretum
# Compare urban effect using weather station data and then hobo logger data
# 2) GDDlo ~ urban + (urban|species) - do once with weather station data and once with hobo logger data
## Let's start with Question 1 first...
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
## Let's load some real data to check out.
setwd("~/Documents/git/microclimates/analyses/")
figpath <- "figures"
figpathmore <- "ws_urb"
source("source/microurban_muplot.R")
# Set up colors
cols <- adjustcolor("indianred3", alpha.f = 0.3)
my.pal <- rep(brewer.pal(n = 12, name = "Paired"), 4)
# display.brewer.all()
my.pch <- rep(15:18, each=12)
alphahere = 0.4
# Load fitted stan model: no interactions
#load("stan/hobo_urban_mod.Rdata")
load("stan/ws_urban_mod.Rda")
sumer.ws <- summary(wsall_urb_mod)$summary
sumer.ws[grep("mu_", rownames(sumer.ws)),]
unique(ws_urb.stan$spp) # numbers are alphabetical
# Load fitted stan model: no interactions
#load("stan/hobo_urban_mod.Rdata")
#load("stan/ws_urban_mod.Rda")
load("stan/wsall_urban_mod.Rda")
# Load fitted stan model: no interactions
#load("stan/hobo_urban_mod.Rdata")
#load("stan/ws_urban_mod.Rdata")
load("stan/wsall_urban_mod.Rdata")
sumer.ws <- summary(wsall_urb_mod)$summary
sumer.ws[grep("mu_", rownames(sumer.ws)),]
unique(ws_urb.stan$spp) # numbers are alphabetical
sort(unique(ws_urb.stan$spp))
ws_urb <- read.csv("output/clean_gdd_bbanddvr.csv")
ws_urb$urban <- NA
ws_urb$urban <- ifelse(ws_urb$type=="Harvard Forest", 0, ws_urb$urban)
ws_urb$urban <- ifelse(ws_urb$type=="Treespotters", 1, ws_urb$urban)
ws_urb.stan <- subset(ws_urb, select=c(gdd_bb, urban, genus, species))
ws_urb.stan <- ws_urb.stan[(complete.cases(ws_urb.stan)),]
ws_urb.stan$spp <- paste(ws_urb.stan$genus, ws_urb.stan$species, sep="_")
ws_urb.stan <- ws_urb.stan[(ws_urb.stan$gdd_bb<=1000),]
# Load fitted stan model: no interactions
#load("stan/hobo_urban_mod.Rdata")
#load("stan/ws_urban_mod.Rdata")
load("stan/wsall_urban_mod.Rdata")
sumer.ws <- summary(wsall_urb_mod)$summary
sumer.ws[grep("mu_", rownames(sumer.ws)),]
unique(ws_urb.stan$spp) # numbers are alphabetical
sort(unique(ws_urb.stan$spp))
# m1.bb <- m2l.ni
modelhere <- wsall_urb_mod
muplotfx(modelhere, "", 7, 8, c(0,2), c(-400, 700) , 750, 2)
## Let's start with Question 1 first...
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
## Let's load some real data to check out.
setwd("~/Documents/git/microclimates/analyses/")
figpath <- "figures"
figpathmore <- "hobo_urb"
source("source/microurban_muplot.R")
# Set up colors
cols <- adjustcolor("indianred3", alpha.f = 0.3)
my.pal <- rep(brewer.pal(n = 12, name = "Paired"), 4)
# display.brewer.all()
my.pch <- rep(15:18, each=12)
alphahere = 0.4
if(figpathmore=="ws_urb"){
ws_urb <- read.csv("output/clean_gdd_bbanddvr.csv")
ws_urb$urban <- NA
ws_urb$urban <- ifelse(ws_urb$type=="Harvard Forest", 0, ws_urb$urban)
ws_urb$urban <- ifelse(ws_urb$type=="Treespotters", 1, ws_urb$urban)
#ws_urb <- ws_urb[(ws_urb$year>=2019),]
ws_urb.stan <- subset(ws_urb, select=c(gdd_bb, urban, genus, species))
ws_urb.stan <- ws_urb.stan[(complete.cases(ws_urb.stan)),]
ws_urb.stan$spp <- paste(ws_urb.stan$genus, ws_urb.stan$species, sep="_")
ws_urb.stan <- ws_urb.stan[(ws_urb.stan$gdd_bb<=1000),]
} else if(figpathmore=="hobo_urb"){
hobo_urb <- read.csv("output/clean_gdd_bbanddvr_hobo.csv")
hobo_urb$urban <- NA
hobo_urb$urban <- ifelse(hobo_urb$type=="Harvard Forest", 0, hobo_urb$urban)
hobo_urb$urban <- ifelse(hobo_urb$type=="Treespotters", 1, hobo_urb$urban)
#ws_urb <- ws_urb[(ws_urb$year>=2019),]
hobo_urb.stan <- subset(hobo_urb, select=c(gdd_bb, urban, genus, species))
hobo_urb.stan <- hobo_urb.stan[(complete.cases(hobo_urb.stan)),]
hobo_urb.stan$spp <- paste(hobo_urb.stan$genus, hobo_urb.stan$species, sep="_")
hobo_urb.stan <- hobo_urb.stan[(hobo_urb.stan$gdd_bb<=1000),]
}
# Load fitted stan model: no interactions
load("stan/hobo_urban_mod.Rdata")
# Load fitted stan model: no interactions
load("stan/hobo_urban_mod.Rdata")
sumer.ws <- summary(hobo_urb_mod)$summary
sumer.ws[grep("mu_", rownames(sumer.ws)),]
unique(hobo_urb.stan$spp) # numbers are alphabetical
sort(unique(hobo_urb.stan$spp))
# m1.bb <- m2l.ni
modelhere <- hobo_urb_mod
muplotfx(modelhere, "", 7, 8, c(0,2), c(-400, 700) , 750, 2)
