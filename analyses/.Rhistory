modoutput$term<-gsub(".*spp","",modoutput$term)
#modoutput$term <- ifelse(modoutput$term=="provenance.lat", "xlat", modoutput$term)
modoutput$Jvar <- as.numeric(rev(as.factor(modoutput$term)))
modoutput$intercept <- modoutput$estimate[modoutput$term=="Intercept"]
modoutput$int.25 <- modoutput$`25%`[modoutput$term=="Intercept"]
modoutput$int.75 <- modoutput$`75%`[modoutput$term=="Intercept"]
modoutput$estclean <- NA
modoutput$estclean <- ifelse(modoutput$term!="Intercept",
modoutput$estimate + modoutput$intercept, modoutput$estimate)
modoutput$clean.25 <- ifelse(modoutput$term!="Intercept",
modoutput$`25%` + modoutput$int.25, modoutput$`25%`)
modoutput$clean.75 <- ifelse(modoutput$term!="Intercept",
modoutput$`75%` + modoutput$int.75, modoutput$`75%`)
estimates<-c("Acer pensylvanicum", "Acer rubrum", "Acer saccharum", "Betula alleghaniensis",
"Fagus grandifolia", "Fraxinus americana", "Hamamelis virginiana", "Quercus alba", "Quercus rubra") #### For Harvard Forest
estimates<-rev(estimates)
modoutput <- modoutput[!is.na(modoutput$Jvar),]
muplot.station<-ggplot(modoutput, aes(x=`clean.25`, xend=`clean.75`, y=Jvar, yend=Jvar)) +
geom_vline(xintercept=0, linetype="dotted") +
geom_point(aes(x=estclean, y=Jvar), col="black") +
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
guides(size=FALSE) +
scale_y_discrete(limits = sort(unique(modoutput$term)), labels=estimates) +
xlab("Change in growing degree days from \nbudburst to leafout") + ### change based on time
ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = "none",
legend.text.align = 0,
plot.margin = unit(c(1,0,1,1), "lines")) +
coord_cartesian(xlim=c(-400, 800), clip = 'off') + ggtitle("A. Tree Spotters: \nWeather Station") ### change based on location
muplot.station
modoutput <- gddlostation #modelhere
modoutput<-modoutput[1:9,] ### [1:15,] for TS; [1:9,] for HF
modoutput$`25%` <- modoutput$lower
modoutput$`75%` <- modoutput$upper
modoutput$term<-gsub(".*b_","",modoutput$term)
modoutput$term<-gsub(".*spp","",modoutput$term)
#modoutput$term <- ifelse(modoutput$term=="provenance.lat", "xlat", modoutput$term)
modoutput$Jvar <- as.numeric(rev(as.factor(modoutput$term)))
modoutput$intercept <- modoutput$estimate[modoutput$term=="Intercept"]
modoutput$int.25 <- modoutput$`25%`[modoutput$term=="Intercept"]
modoutput$int.75 <- modoutput$`75%`[modoutput$term=="Intercept"]
modoutput$estclean <- NA
modoutput$estclean <- ifelse(modoutput$term!="Intercept",
modoutput$estimate + modoutput$intercept, modoutput$estimate)
modoutput$clean.25 <- ifelse(modoutput$term!="Intercept",
modoutput$`25%` + modoutput$int.25, modoutput$`25%`)
modoutput$clean.75 <- ifelse(modoutput$term!="Intercept",
modoutput$`75%` + modoutput$int.75, modoutput$`75%`)
estimates<-c("Acer pensylvanicum", "Acer rubrum", "Acer saccharum", "Betula alleghaniensis",
"Fagus grandifolia", "Fraxinus americana", "Hamamelis virginiana", "Quercus alba", "Quercus rubra") #### For Harvard Forest
estimates<-rev(estimates)
modoutput <- modoutput[!is.na(modoutput$Jvar),]
muplot.station<-ggplot(modoutput, aes(x=`clean.25`, xend=`clean.75`, y=Jvar, yend=Jvar)) +
geom_vline(xintercept=0, linetype="dotted") +
geom_point(aes(x=estclean, y=Jvar), col="black") +
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
guides(size=FALSE) +
scale_y_discrete(limits = sort(unique(modoutput$term)), labels=estimates) +
xlab("Change in growing degree days from \nbudburst to leafout") + ### change based on time
ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = "none",
legend.text.align = 0,
plot.margin = unit(c(1,0,1,1), "lines")) +
coord_cartesian(xlim=c(-400, 800), clip = 'off') + ggtitle("A. Harvard Forest: \nWeather Station") ### change based on location
muplot.station
muplot.station<-ggplot(modoutput, aes(x=`clean.25`, xend=`clean.75`, y=Jvar, yend=Jvar)) +
geom_vline(xintercept=0, linetype="dotted") +
geom_point(aes(x=estclean, y=Jvar), col="black") +
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
guides(size=FALSE) +
scale_y_discrete(limits = sort(unique(modoutput$term)), labels=estimates) +
xlab("Change in growing degree days from \nbudburst to leafout") + ### change based on time
ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = "none",
legend.text.align = 0,
plot.margin = unit(c(1,0,1,1), "lines")) +
coord_cartesian(xlim=c(0, 600), clip = 'off') + ggtitle("A. Harvard Forest: \nWeather Station") ### change based on location
modoutput <- gddlohobo #modelhere
modoutput<-modoutput[1:9,] ### [1:15,] for TS; [1:9,] for HF
modoutput$`25%` <- modoutput$lower
modoutput$`75%` <- modoutput$upper
modoutput$term<-gsub(".*b_","",modoutput$term)
modoutput$term<-gsub(".*spp","",modoutput$term)
#modoutput$term <- ifelse(modoutput$term=="provenance.lat", "xlat", modoutput$term)
modoutput$Jvar <- as.numeric(rev(as.factor(modoutput$term)))
modoutput$intercept <- modoutput$estimate[modoutput$term=="Intercept"]
modoutput$int.25 <- modoutput$`25%`[modoutput$term=="Intercept"]
modoutput$int.75 <- modoutput$`75%`[modoutput$term=="Intercept"]
modoutput$estclean <- NA
modoutput$estclean <- ifelse(modoutput$term!="Intercept",
modoutput$estimate + modoutput$intercept, modoutput$estimate)
modoutput$clean.25 <- ifelse(modoutput$term!="Intercept",
modoutput$`25%` + modoutput$int.25, modoutput$`25%`)
modoutput$clean.75 <- ifelse(modoutput$term!="Intercept",
modoutput$`75%` + modoutput$int.75, modoutput$`75%`)
estimates<-c("Acer pensylvanicum", "Acer rubrum", "Acer saccharum", "Betula alleghaniensis",
"Fagus grandifolia", "Fraxinus americana", "Hamamelis virginiana", "Quercus alba", "Quercus rubra") #### For Harvard Forest
estimates<-rev(estimates)
modoutput <- modoutput[!is.na(modoutput$Jvar),]
muplot.hobo<-ggplot(modoutput, aes(x=`clean.25`, xend=`clean.75`, y=Jvar, yend=Jvar)) +
geom_vline(xintercept=0, linetype="dotted") +
geom_point(aes(x=estclean, y=Jvar), col="black") +
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
guides(size=FALSE) +
scale_y_discrete(limits = sort(unique(modoutput$term)), labels=estimates) +
xlab("Change in growing degree days from \nbudburst to leafout") + ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = "none",
legend.text.align = 0,
plot.margin = unit(c(1,1,1,0), "lines")) +  ### think 'trouble'
coord_cartesian(xlim=c(0, 600), clip = 'off') + ggtitle("B. Harvard Forest: \nHobo Loggers") ### change based on location
ggarrange(muplot.station, muplot.hobo, ncol=2)
# housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
## Load the data
gdd.stan <- read.csv("output/clean_gdd_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv", header=TRUE)
gdd.stan <- gdd.stan[(gdd.stan$type=="Harvard Forest"),] ### CHANGE BASED ON TYPE
gdd.hobo <- gdd.hobo[(gdd.hobo$type=="Harvard Forest"),]
gdd.hobo$gdd_bb_hobo <- gdd.hobo$gdd_bb
gdd.hobo$gdd_dvr_hobo <- gdd.hobo$gdd_dvr
gdd.hobo$gdd_bb <- NULL
gdd.hobo$gdd_dvr <- NULL
gdd.hobo$spp <- paste(substr(gdd.hobo$genus, 0, 3), substr(gdd.hobo$species, 0, 3), sep="")
gdd.stan$spp <- paste(substr(gdd.stan$genus, 0, 3), substr(gdd.stan$species, 0, 3), sep="")
commoncols <- c("id", "provenance.lat", "fs.count", "year", "budburst", "leafout", "spp", "climatetype")
gdd.hobo <- subset(gdd.hobo, select=c(commoncols, "gdd_bb_hobo", "gdd_dvr_hobo"))
gdd.stan <- subset(gdd.stan, select=c(commoncols, "gdd_bb", "gdd_dvr"))
gdd.hobo$hobonum <- gdd.hobo$climatetype
gdd.hobo$climatetype <- NULL
gdd <- full_join(gdd.stan, gdd.hobo)
gdd$dvr <- gdd$leafout - gdd$budburst
gdd$leafout <- NULL
gdd <- gdd[(gdd$year==2019),]
gdd <- gdd[(gdd$gdd_bb<=1000),]
gdd <- gdd[(gdd$gdd_bb_hobo<=1000),]
gdd$gdd.diffdvr <- gdd$gdd_dvr_hobo - gdd$gdd_dvr ## mean=3.81; range=c(-1.24, 12.17); sd=3.77
gdd$gdd.diffbb <- gdd$gdd_bb_hobo - gdd$gdd_bb ## mean = 5.18; range=c(3.48, 9.95); sd=1.82
gddplot.bb <- subset(gdd, select=c("provenance.lat", "fs.count", "spp", "gdd_bb", "gdd_bb_hobo", "budburst", "hobonum", "dvr"))
gddplot.dvr <- subset(gdd, select=c("provenance.lat", "fs.count", "spp", "gdd_dvr", "gdd_dvr_hobo", "budburst", "hobonum", "dvr"))
gddplot.bb <- na.omit(gddplot.bb)
gddplot.dvr <- na.omit(gddplot.dvr)
gddplot.bb <- gather(gddplot.bb, "method", "gdd", -provenance.lat, -fs.count, -spp, -budburst, -hobonum, -dvr)
gddplot.dvr <- gather(gddplot.dvr, "method", "gdd", -provenance.lat, -fs.count, -spp, -budburst, -hobonum, -dvr)
gddplot.bb$method <- ifelse(gddplot.bb$method=="gdd_bb", gddplot.bb$method, gddplot.bb$hobonum)
gddplot.dvr$method <- ifelse(gddplot.dvr$method=="gdd_dvr", gddplot.dvr$method, gddplot.dvr$hobonum)
gddplot.bb$method.name <- ifelse(gddplot.bb$method!="gdd_bb", "hobo", gddplot.bb$method)
gddplot.bb$gddmean <- ave(gddplot.bb$gdd, gddplot.bb$spp, gddplot.bb$method)
gddplot.bb$gddsd <- ave(gddplot.bb$gdd, gddplot.bb$spp, gddplot.bb$method, FUN=sd)
gddplot.bb$ymin <- gddplot.bb$gddmean-gddplot.bb$gddsd
gddplot.bb$ymax <- gddplot.bb$gddmean+gddplot.bb$gddsd
gddplot.dvr$gddmean <- ave(gddplot.dvr$gdd, gddplot.dvr$spp, gddplot.dvr$method)
gddplot.dvr$gddsd <- ave(gddplot.dvr$gdd, gddplot.dvr$spp, gddplot.dvr$method, FUN=sd)
gddplot.dvr$ymin <- gddplot.dvr$gddmean-gddplot.dvr$gddsd
gddplot.dvr$ymax <- gddplot.dvr$gddmean+gddplot.dvr$gddsd
gddplot.bb$species.name <- NA
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Acepen", "Acer pensylvanicum", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Acerub", "Acer rubrum", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Acesac", "Acer saccharum", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Aesfla", "Aesculus flava", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Betall", "Betula alleghaniensis", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Betnig", "Betula nigra", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Cargla", "Carya glabra", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Carova", "Carya ovata", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Faggra", "Fagus grandifolia", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Fraame", "Fraxinus americana", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Hamvir", "Hamamelis virginiana", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Popdel", "Populus deltoides", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Quealb", "Quercus alba", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Querub", "Quercus rubra", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Tilame", "Tilia americana", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Vaccor", "Vaccinium corymbosum", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Vibnud", "Viburnum nudum", gddplot.bb$species.name)
cols <- colorRampPalette(brewer.pal(3,"Dark2"))(2)
gddbarbb <- ggplot(gddplot.bb, aes(x=species.name, y=gddmean, fill=method.name)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing degree days to budburst") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) + coord_cartesian(expand=c(0,0))
quartz()
gddbarbb
View(gddplot.bb)
gddbardvr <- ggplot(gddplot.dvr, aes(x=spp, y=gddmean, fill=method)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing degree days from budburst to leafout") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) + coord_cartesian(expand=c(0,0))
gddbardvr
cols <- colorRampPalette(brewer.pal(3,"Dark2"))(2)
gddbardvr <- ggplot(gddplot.dvr, aes(x=spp, y=gddmean, fill=method)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing degree days from budburst to leafout") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) + coord_cartesian(expand=c(0,0))
gddbardvr
View(gddplot.dvr)
View(gddplot.bb)
cols <- viridis_pal(option="C")(11)
#cols <- colorRampPalette(brewer.pal(11, "Accent"))(11)
cols <- c(cols, "black")
unique(gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf1", "hf01", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf3", "hf03", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf4", "hf04", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf5", "hf05", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf6", "hf06", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf7", "hf07", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf9", "hf09", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf11", "hf11", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf12", "hf12", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf13", "hf13", gddplot.bb$method)
bb.loggers <- ggplot(gddplot.bb, aes(x=budburst, y=gdd, col=method, linetype=method)) + geom_point() +
geom_line() + scale_color_manual(name="Method", values=cols,
labels=c("hf01"="#01",
"hf03"="#03",
"hf04"="#04",
"hf05"="#5",
"hf06"="#6",
"hf07"="#07",
"hf09"="#09",
"hf11"="#11",
"hf11"="#12",
"hf11"="#13",
"gdd_bb"="Weather Station")) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
#axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("Day of budburst") + ylab("Growing degree days") + guides(linetype=FALSE)
bb.loggers
cols <- viridis_pal(option="C")(10) ### 10 for HF, 11 for Arb
#cols <- colorRampPalette(brewer.pal(11, "Accent"))(11)
cols <- c(cols, "black")
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf1", "hf01", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf3", "hf03", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf4", "hf04", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf5", "hf05", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf6", "hf06", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf7", "hf07", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf9", "hf09", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf11", "hf11", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf12", "hf12", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf13", "hf13", gddplot.bb$method)
bb.loggers <- ggplot(gddplot.bb, aes(x=budburst, y=gdd, col=method, linetype=method)) + geom_point() +
geom_line() + scale_color_manual(name="Method", values=cols,
labels=c("hf01"="#01",
"hf03"="#03",
"hf04"="#04",
"hf05"="#05",
"hf06"="#06",
"hf07"="#07",
"hf09"="#09",
"hf11"="#11",
"hf11"="#12",
"hf11"="#13",
"gdd_bb"="Weather Station")) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
#axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("Day of budburst") + ylab("Growing degree days") + guides(linetype=FALSE)
bb.loggers
bb.loggers <- ggplot(gddplot.bb, aes(x=budburst, y=gdd, col=method, linetype=method)) + geom_point() +
geom_line() + scale_color_manual(name="Method", values=cols,
labels=c("hf01"="#01",
"hf03"="#03",
"hf04"="#04",
"hf05"="#05",
"hf06"="#06",
"hf07"="#07",
"hf09"="#09",
"hf11"="#11",
"hf12"="#12",
"hf13"="#13",
"gdd_bb"="Weather Station")) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
#axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("Day of budburst") + ylab("Growing degree days") + guides(linetype=FALSE)
bb.loggers
View(gddplot.bb)
bb.loggers <- ggplot(gddplot.bb, aes(x=budburst, y=gdd, col=method, linetype=method)) + geom_point() +
geom_line() + scale_color_manual(name="Method", values=cols,
labels=c("hf01"="Hobo #01",
"hf03"="Hobo #03",
"hf04"="Hobo #04",
"hf05"="Hobo #05",
"hf06"="Hobo #06",
"hf07"="Hobo #07",
"hf09"="Hobo #09",
"hf11"="Hobo #11",
"hf12"="Hobo #12",
"hf13"="Hobo #13",
"gdd_bb"="Weather Station")) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
#axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("Day of budburst") + ylab("Growing degree days") + guides(linetype=FALSE)
bb.loggers
gddplot.bb$method <- sort(gddplot.bb$method)
bb.loggers <- ggplot(gddplot.bb, aes(x=budburst, y=gdd, col=method, linetype=method)) + geom_point() +
geom_line() + scale_color_manual(name="Method", values=cols,
labels=c("hf01"="Hobo #01",
"hf03"="Hobo #03",
"hf04"="Hobo #04",
"hf05"="Hobo #05",
"hf06"="Hobo #06",
"hf07"="Hobo #07",
"hf09"="Hobo #09",
"hf11"="Hobo #11",
"hf12"="Hobo #12",
"hf13"="Hobo #13",
"gdd_bb"="Weather Station")) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
#axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("Day of budburst") + ylab("Growing degree days") + guides(linetype=FALSE)
bb.loggers
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)
# Set working directory
setwd("~/Documents/git/microclimates/analyses")
## Load the data
gdd.stan <- read.csv("output/clean_gdd_bbanddvr.csv", header=TRUE)
gdd.hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv", header=TRUE)
if(FALSE){ ## Testing code
gdd.stan$stationbb <- gdd.stan$gdd_bb
gdd.stan$gdd_bb <- NULL
gdd.stan$stationdvr <- gdd.stan$gdd_dvr
gdd.stan$gdd_dvr <- NULL
gdd <- left_join(gdd.hobo, gdd.stan)
gdd$diffbb <- gdd$stationbb - gdd$gdd_bb
gdd$diffdvr <- gdd$stationdvr - gdd$gdd_dvr
range(gdd$diffdvr, na.rm=TRUE)
range(gdd$diffbb, na.rm=TRUE)
}
gdd.stan <- gdd.stan[(gdd.stan$type=="Harvard Forest"),] ### CHANGE BASED ON TYPE
gdd.hobo <- gdd.hobo[(gdd.hobo$type=="Harvard Forest"),]
gdd.hobo$gdd_bb_hobo <- gdd.hobo$gdd_bb
gdd.hobo$gdd_dvr_hobo <- gdd.hobo$gdd_dvr
gdd.hobo$gdd_bb <- NULL
gdd.hobo$gdd_dvr <- NULL
gdd.hobo$spp <- paste(substr(gdd.hobo$genus, 0, 3), substr(gdd.hobo$species, 0, 3), sep="")
gdd.stan$spp <- paste(substr(gdd.stan$genus, 0, 3), substr(gdd.stan$species, 0, 3), sep="")
commoncols <- c("id", "provenance.lat", "fs.count", "year", "budburst", "leafout", "spp", "climatetype")
gdd.hobo <- subset(gdd.hobo, select=c(commoncols, "gdd_bb_hobo", "gdd_dvr_hobo"))
gdd.stan <- subset(gdd.stan, select=c(commoncols, "gdd_bb", "gdd_dvr"))
gdd.hobo$hobonum <- gdd.hobo$climatetype
gdd.hobo$climatetype <- NULL
gdd <- full_join(gdd.stan, gdd.hobo)
gdd$dvr <- gdd$leafout - gdd$budburst
gdd$leafout <- NULL
gdd <- gdd[(gdd$year==2019),]
gdd <- gdd[(gdd$gdd_bb<=1000),]
gdd <- gdd[(gdd$gdd_bb_hobo<=1000),]
gdd$gdd.diffdvr <- gdd$gdd_dvr_hobo - gdd$gdd_dvr ## mean=3.81; range=c(-1.24, 12.17); sd=3.77
gdd$gdd.diffbb <- gdd$gdd_bb_hobo - gdd$gdd_bb ## mean = 5.18; range=c(3.48, 9.95); sd=1.82
gddplot.bb <- subset(gdd, select=c("provenance.lat", "fs.count", "spp", "gdd_bb", "gdd_bb_hobo", "budburst", "hobonum", "dvr"))
gddplot.dvr <- subset(gdd, select=c("provenance.lat", "fs.count", "spp", "gdd_dvr", "gdd_dvr_hobo", "budburst", "hobonum", "dvr"))
gddplot.bb <- na.omit(gddplot.bb)
gddplot.dvr <- na.omit(gddplot.dvr)
gddplot.bb <- gather(gddplot.bb, "method", "gdd", -provenance.lat, -fs.count, -spp, -budburst, -hobonum, -dvr)
gddplot.dvr <- gather(gddplot.dvr, "method", "gdd", -provenance.lat, -fs.count, -spp, -budburst, -hobonum, -dvr)
gddplot.bb$method <- ifelse(gddplot.bb$method=="gdd_bb", gddplot.bb$method, gddplot.bb$hobonum)
gddplot.dvr$method <- ifelse(gddplot.dvr$method=="gdd_dvr", gddplot.dvr$method, gddplot.dvr$hobonum)
gddplot.bb$method.name <- ifelse(gddplot.bb$method!="gdd_bb", "hobo", gddplot.bb$method)
gddplot.bb$gddmean <- ave(gddplot.bb$gdd, gddplot.bb$spp, gddplot.bb$method)
gddplot.bb$gddsd <- ave(gddplot.bb$gdd, gddplot.bb$spp, gddplot.bb$method, FUN=sd)
gddplot.bb$ymin <- gddplot.bb$gddmean-gddplot.bb$gddsd
gddplot.bb$ymax <- gddplot.bb$gddmean+gddplot.bb$gddsd
gddplot.dvr$gddmean <- ave(gddplot.dvr$gdd, gddplot.dvr$spp, gddplot.dvr$method)
gddplot.dvr$gddsd <- ave(gddplot.dvr$gdd, gddplot.dvr$spp, gddplot.dvr$method, FUN=sd)
gddplot.dvr$ymin <- gddplot.dvr$gddmean-gddplot.dvr$gddsd
gddplot.dvr$ymax <- gddplot.dvr$gddmean+gddplot.dvr$gddsd
gddplot.bb$species.name <- NA
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Acepen", "Acer pensylvanicum", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Acerub", "Acer rubrum", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Acesac", "Acer saccharum", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Aesfla", "Aesculus flava", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Betall", "Betula alleghaniensis", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Betnig", "Betula nigra", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Cargla", "Carya glabra", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Carova", "Carya ovata", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Faggra", "Fagus grandifolia", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Fraame", "Fraxinus americana", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Hamvir", "Hamamelis virginiana", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Popdel", "Populus deltoides", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Quealb", "Quercus alba", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Querub", "Quercus rubra", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Tilame", "Tilia americana", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Vaccor", "Vaccinium corymbosum", gddplot.bb$species.name)
gddplot.bb$species.name <- ifelse(gddplot.bb$spp=="Vibnud", "Viburnum nudum", gddplot.bb$species.name)
cols <- colorRampPalette(brewer.pal(3,"Dark2"))(2)
gddbarbb <- ggplot(gddplot.bb, aes(x=species.name, y=gddmean, fill=method.name)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Growing degree days to budburst") +
scale_fill_manual(name="Method", values=cols,
labels=c("Weather Station", "Hobo Logger")) + coord_cartesian(expand=c(0,0))
cols <- viridis_pal(option="C")(10) ### 10 for HF, 11 for Arb
#cols <- colorRampPalette(brewer.pal(11, "Accent"))(11)
cols <- c(cols, "black")
#gddplot.bb$method <- sort(gddplot.bb$method)
bb.loggers <- ggplot(gddplot.bb, aes(x=budburst, y=gdd, col=method, linetype=method)) + geom_point() +
geom_line() + scale_color_manual(name="Method", values=cols,
labels=c("hf01"="Hobo #01",
"hf03"="Hobo #03",
"hf04"="Hobo #04",
"hf05"="Hobo #05",
"hf06"="Hobo #06",
"hf07"="Hobo #07",
"hf09"="Hobo #09",
"hf11"="Hobo #11",
"hf12"="Hobo #12",
"hf13"="Hobo #13",
"gdd_bb"="Weather Station")) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
#axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("Day of budburst") + ylab("Growing degree days") + guides(linetype=FALSE)
bb.loggers
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf1", "hf01", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf3", "hf03", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf4", "hf04", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf5", "hf05", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf6", "hf06", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf7", "hf07", gddplot.bb$method)
gddplot.bb$method<-ifelse(gddplot.bb$method=="hf9", "hf09", gddplot.bb$method)
gddplot.bb$method <- ifelse(gddplot.bb$method=="gdd_bb", "zgdd_bb", gddplot.bb$method)
bb.loggers <- ggplot(gddplot.bb, aes(x=budburst, y=gdd, col=method, linetype=method)) + geom_point() +
geom_line() + scale_color_manual(name="Method", values=cols,
labels=c("hf01"="Hobo #01",
"hf03"="Hobo #03",
"hf04"="Hobo #04",
"hf05"="Hobo #05",
"hf06"="Hobo #06",
"hf07"="Hobo #07",
"hf09"="Hobo #09",
"hf11"="Hobo #11",
"hf12"="Hobo #12",
"hf13"="Hobo #13",
"zgdd_bb"="Weather Station")) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
#axis.text.x = element_text(angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("Day of budburst") + ylab("Growing degree days") + guides(linetype=FALSE)
bb.loggers
