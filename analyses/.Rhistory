sp = as.numeric(as.factor(species)),
N = nrow(bball),
n_sp = length(unique(bball$species))
)
)
}
urbmethod_fake = stan('stan/urbanmethod_normal_ncp.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake <- summary(urbmethod_fake)$summary
urbmethod_fake[grep("mu_", rownames(urbmethod_fake)),]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake))[1:4],]
# housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
#### Questions to address:
# GDDlo ~ urban + (urban|species)
## Let's start with Question 1 first...
#library(rethinking)
library(RColorBrewer)
library(viridis)
library(lme4)
library(ggplot2)
library(gridExtra)
library(rstan)
## Let's load some real data to check out.
setwd("~/Documents/git/microclimates/analyses/")
if(FALSE){
ws <- read.csv("output/clean_gdd_chill_bbanddvr.csv")
mean(ws$gdd_bb, na.rm=TRUE) ## 292
sd(ws$gdd_bb, na.rm = TRUE) ## 116
mean(ws$budburst) ## 109.15
sd(ws$budburst) ## 14.22
mean(ws$budburst[ws$type=="Harvard Forest"]) ## 132.75
mean(ws$budburst[ws$type=="Treespotters"]) ## 112.45
}
use.urban = TRUE
use.provenance = FALSE
use.fstar = FALSE
use.doy = TRUE
if(use.urban == TRUE & use.provenance == TRUE){
print("Error has occurred. Can't have both urban and provenance equal TRUE!")
}
if(use.urban == FALSE & use.provenance == FALSE){
print("Error has occurred. Can't have both urban and provenance equal TRUE!")
}
# Step 1: Set up years, days per year, temperatures, sampling frequency, required GDD (fstar)
daysperyr <- 200 #### just to make sure we don't get any NAs
nspps <- 20
ninds <- 10
nobs <- nspps*ninds
nsites <- 2
nmicros <- 10
nmethods <- 2 ## weather station and hobo logger to start (want to eventually add in gridded climate data)
if(use.urban==TRUE & use.fstar==TRUE){
urbeffect <- -75  ### mu_b_tx_sp
urbsd <- 20 ## sigma_b_tx_sp
methodeffect <- -75 ## mu_b_method_sp
methodsd <- 20 ## sigma_b_method_sp
}
if(use.urban==TRUE & use.doy==TRUE){
urbeffect <- 0  ### mu_b_tx_sp
urbsd <- 3 ## sigma_b_tx_sp
methodeffect <- 0 ## mu_b_method_sp
methodsd <- 3 ## sigma_b_method_sp
}
if(use.provenance==TRUE){
proveffect <- -5
provsd <- 0 ## sigma_b_tx_sp
methodeffect <- 100 ## mu_b_method_sp
methodsd <- 0 ## sigma_b_method_sp
}
if(use.fstar==TRUE){
fstar <- 400 ## day of budburst now (this should be mu_a_sp)
fstarspeciessd <- 50 ### sigma_a_sp
fstarindsd <- 20 ## sigma_y
}
if(use.doy==TRUE){
doybb <- 80 ## day of budburst now (this should be mu_a_sp)
doybbspeciessd <- 5### sigma_a_sp
doybbindsd <- 2 ## sigma_y
}
dayz <- rep(1:daysperyr, nobs)
cc.arb <- 6 ## based off weather station data
microarb.effect <- 0
sigma.arb <- 2
microsigmaarb.effect <- 4   #### by keeping the sigmas the same for the microsites (line 76 & 81) we assume that the microclimatic effects are the same across sites
cc.hf <- 6  ## based off weather station data
microhf.effect <- 0
sigma.hf <- 2
microsigmahf.effect <- 0  #### by keeping the sigmas the same for the microsites (line 76 & 81) we assume that the microclimatic effects are the same across sites
#source("simulations/micro_databuildfx.R")
source("simulations/micro_databuildfx_doy.R")
#####And finally... it's modelling time!
if(use.urban==TRUE){
bball$urban <- ifelse(bball$site=="arb", 1, 0)
bball$type <- ifelse(bball$method=="ws", 1, 0)
datalist.gdd <- with(bball,
list(y = gdd,
tx = urban,
method = type,
sp = as.numeric(as.factor(species)),
N = nrow(bball),
n_sp = length(unique(bball$species))
)
)
}
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
datalist.gdd <- with(bball,
list(y = gdd,
urban = urban,
method = type,
sp = as.numeric(as.factor(species)),
N = nrow(bball),
n_sp = length(unique(bball$species))
)
)
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake <- summary(urbmethod_fake)$summary
urbmethod_fake[grep("mu_", rownames(urbmethod_fake)),]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake))[1:4],]
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake <- summary(urbmethod_fake)$summary
urbmethod_fake[grep("mu_", rownames(urbmethod_fake)),]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake))[1:4],]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake)),]
# housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
#### Questions to address:
# GDDlo ~ urban + (urban|species)
## Let's start with Question 1 first...
#library(rethinking)
library(RColorBrewer)
library(viridis)
library(lme4)
library(ggplot2)
library(gridExtra)
library(rstan)
## Let's load some real data to check out.
setwd("~/Documents/git/microclimates/analyses/")
if(FALSE){
ws <- read.csv("output/clean_gdd_chill_bbanddvr.csv")
mean(ws$gdd_bb, na.rm=TRUE) ## 292
sd(ws$gdd_bb, na.rm = TRUE) ## 116
mean(ws$budburst) ## 109.15
sd(ws$budburst) ## 14.22
mean(ws$budburst[ws$type=="Harvard Forest"]) ## 132.75
mean(ws$budburst[ws$type=="Treespotters"]) ## 112.45
}
use.urban = TRUE
use.provenance = FALSE
use.fstar = FALSE
use.doy = TRUE
if(use.urban == TRUE & use.provenance == TRUE){
print("Error has occurred. Can't have both urban and provenance equal TRUE!")
}
if(use.urban == FALSE & use.provenance == FALSE){
print("Error has occurred. Can't have both urban and provenance equal TRUE!")
}
# Step 1: Set up years, days per year, temperatures, sampling frequency, required GDD (fstar)
daysperyr <- 200 #### just to make sure we don't get any NAs
nspps <- 20
ninds <- 10
nobs <- nspps*ninds
nsites <- 2
nmicros <- 10
nmethods <- 2 ## weather station and hobo logger to start (want to eventually add in gridded climate data)
if(use.urban==TRUE & use.fstar==TRUE){
urbeffect <- -75  ### mu_b_tx_sp
urbsd <- 20 ## sigma_b_tx_sp
methodeffect <- -75 ## mu_b_method_sp
methodsd <- 20 ## sigma_b_method_sp
}
if(use.urban==TRUE & use.doy==TRUE){
urbeffect <- 0  ### mu_b_tx_sp
urbsd <- 3 ## sigma_b_tx_sp
methodeffect <- 0 ## mu_b_method_sp
methodsd <- 3 ## sigma_b_method_sp
}
if(use.provenance==TRUE){
proveffect <- -5
provsd <- 0 ## sigma_b_tx_sp
methodeffect <- 100 ## mu_b_method_sp
methodsd <- 0 ## sigma_b_method_sp
}
if(use.fstar==TRUE){
fstar <- 400 ## day of budburst now (this should be mu_a_sp)
fstarspeciessd <- 50 ### sigma_a_sp
fstarindsd <- 20 ## sigma_y
}
if(use.doy==TRUE){
doybb <- 80 ## day of budburst now (this should be mu_a_sp)
doybbspeciessd <- 5### sigma_a_sp
doybbindsd <- 2 ## sigma_y
}
dayz <- rep(1:daysperyr, nobs)
cc.arb <- 6 ## based off weather station data
microarb.effect <- 0
sigma.arb <- 2
microsigmaarb.effect <- 4   #### by keeping the sigmas the same for the microsites (line 76 & 81) we assume that the microclimatic effects are the same across sites
cc.hf <- 6  ## based off weather station data
microhf.effect <- 0
sigma.hf <- 2
microsigmahf.effect <- 4  #### by keeping the sigmas the same for the microsites (line 76 & 81) we assume that the microclimatic effects are the same across sites
#source("simulations/micro_databuildfx.R")
source("simulations/micro_databuildfx_doy.R")
#####And finally... it's modelling time!
if(use.urban==TRUE){
bball$urban <- ifelse(bball$site=="arb", 1, 0)
bball$type <- ifelse(bball$method=="ws", 1, 0)
datalist.gdd <- with(bball,
list(y = gdd,
urban = urban,
method = type,
sp = as.numeric(as.factor(species)),
N = nrow(bball),
n_sp = length(unique(bball$species))
)
)
}
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake <- summary(urbmethod_fake)$summary
urbmethod_fake[grep("mu_", rownames(urbmethod_fake)),]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake)),]
rm(list=ls())
options(stringsAsFactors = FALSE)
#### Questions to address:
# GDDlo ~ urban + (urban|species)
## Let's start with Question 1 first...
#library(rethinking)
library(RColorBrewer)
library(viridis)
library(lme4)
library(ggplot2)
library(gridExtra)
library(rstan)
## Let's load some real data to check out.
setwd("~/Documents/git/microclimates/analyses/")
if(FALSE){
ws <- read.csv("output/clean_gdd_chill_bbanddvr.csv")
mean(ws$gdd_bb, na.rm=TRUE) ## 292
sd(ws$gdd_bb, na.rm = TRUE) ## 116
mean(ws$budburst) ## 109.15
sd(ws$budburst) ## 14.22
mean(ws$budburst[ws$type=="Harvard Forest"]) ## 132.75
mean(ws$budburst[ws$type=="Treespotters"]) ## 112.45
}
use.urban = TRUE
use.provenance = FALSE
use.fstar = FALSE
use.doy = TRUE
if(use.urban == TRUE & use.provenance == TRUE){
print("Error has occurred. Can't have both urban and provenance equal TRUE!")
}
if(use.urban == FALSE & use.provenance == FALSE){
print("Error has occurred. Can't have both urban and provenance equal TRUE!")
}
# Step 1: Set up years, days per year, temperatures, sampling frequency, required GDD (fstar)
daysperyr <- 200 #### just to make sure we don't get any NAs
nspps <- 20
ninds <- 10
nobs <- nspps*ninds
nsites <- 2
nmicros <- 10
nmethods <- 2 ## weather station and hobo logger to start (want to eventually add in gridded climate data)
if(use.urban==TRUE & use.fstar==TRUE){
urbeffect <- -75  ### mu_b_tx_sp
urbsd <- 20 ## sigma_b_tx_sp
methodeffect <- -75 ## mu_b_method_sp
methodsd <- 20 ## sigma_b_method_sp
}
if(use.urban==TRUE & use.doy==TRUE){
urbeffect <- -10  ### mu_b_tx_sp
urbsd <- 3 ## sigma_b_tx_sp
methodeffect <- 0 ## mu_b_method_sp
methodsd <- 3 ## sigma_b_method_sp
}
if(use.provenance==TRUE){
proveffect <- -5
provsd <- 0 ## sigma_b_tx_sp
methodeffect <- 100 ## mu_b_method_sp
methodsd <- 0 ## sigma_b_method_sp
}
if(use.fstar==TRUE){
fstar <- 400 ## day of budburst now (this should be mu_a_sp)
fstarspeciessd <- 50 ### sigma_a_sp
fstarindsd <- 20 ## sigma_y
}
if(use.doy==TRUE){
doybb <- 80 ## day of budburst now (this should be mu_a_sp)
doybbspeciessd <- 5### sigma_a_sp
doybbindsd <- 2 ## sigma_y
}
dayz <- rep(1:daysperyr, nobs)
cc.arb <- 6 ## based off weather station data
microarb.effect <- 0
sigma.arb <- 2
microsigmaarb.effect <- 4   #### by keeping the sigmas the same for the microsites (line 76 & 81) we assume that the microclimatic effects are the same across sites
cc.hf <- 4  ## based off weather station data
microhf.effect <- 0
sigma.hf <- 2
microsigmahf.effect <- 4  #### by keeping the sigmas the same for the microsites (line 76 & 81) we assume that the microclimatic effects are the same across sites
#source("simulations/micro_databuildfx.R")
source("simulations/micro_databuildfx_doy.R")
#####And finally... it's modelling time!
if(use.urban==TRUE){
bball$urban <- ifelse(bball$site=="arb", 1, 0)
bball$type <- ifelse(bball$method=="ws", 1, 0)
datalist.gdd <- with(bball,
list(y = gdd,
urban = urban,
method = type,
sp = as.numeric(as.factor(species)),
N = nrow(bball),
n_sp = length(unique(bball$species))
)
)
}
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake <- summary(urbmethod_fake)$summary
urbmethod_fake[grep("mu_", rownames(urbmethod_fake)),]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake)),]
# housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
#### Questions to address:
# GDDlo ~ urban + (urban|species)
## Let's start with Question 1 first...
#library(rethinking)
library(RColorBrewer)
library(viridis)
library(lme4)
library(ggplot2)
library(gridExtra)
library(rstan)
## Let's load some real data to check out.
setwd("~/Documents/git/microclimates/analyses/")
if(FALSE){
ws <- read.csv("output/clean_gdd_chill_bbanddvr.csv")
mean(ws$gdd_bb, na.rm=TRUE) ## 292
sd(ws$gdd_bb, na.rm = TRUE) ## 116
mean(ws$budburst) ## 109.15
sd(ws$budburst) ## 14.22
mean(ws$budburst[ws$type=="Harvard Forest"]) ## 132.75
mean(ws$budburst[ws$type=="Treespotters"]) ## 112.45
}
use.urban = TRUE
use.provenance = FALSE
use.fstar = FALSE
use.doy = TRUE
if(use.urban == TRUE & use.provenance == TRUE){
print("Error has occurred. Can't have both urban and provenance equal TRUE!")
}
if(use.urban == FALSE & use.provenance == FALSE){
print("Error has occurred. Can't have both urban and provenance equal TRUE!")
}
# Step 1: Set up years, days per year, temperatures, sampling frequency, required GDD (fstar)
daysperyr <- 200 #### just to make sure we don't get any NAs
nspps <- 20
ninds <- 10
nobs <- nspps*ninds
nsites <- 2
nmicros <- 10
nmethods <- 2 ## weather station and hobo logger to start (want to eventually add in gridded climate data)
if(use.urban==TRUE & use.fstar==TRUE){
urbeffect <- -75  ### mu_b_tx_sp
urbsd <- 20 ## sigma_b_tx_sp
methodeffect <- -75 ## mu_b_method_sp
methodsd <- 20 ## sigma_b_method_sp
}
if(use.urban==TRUE & use.doy==TRUE){
urbeffect <- -10  ### mu_b_tx_sp
urbsd <- 3 ## sigma_b_tx_sp
methodeffect <- 0 ## mu_b_method_sp
methodsd <- 3 ## sigma_b_method_sp
}
if(use.provenance==TRUE){
proveffect <- -5
provsd <- 0 ## sigma_b_tx_sp
methodeffect <- 100 ## mu_b_method_sp
methodsd <- 0 ## sigma_b_method_sp
}
if(use.fstar==TRUE){
fstar <- 400 ## day of budburst now (this should be mu_a_sp)
fstarspeciessd <- 50 ### sigma_a_sp
fstarindsd <- 20 ## sigma_y
}
if(use.doy==TRUE){
doybb <- 80 ## day of budburst now (this should be mu_a_sp)
doybbspeciessd <- 5### sigma_a_sp
doybbindsd <- 2 ## sigma_y
}
dayz <- rep(1:daysperyr, nobs)
cc.arb <- 6 ## based off weather station data
microarb.effect <- 0
sigma.arb <- 2
microsigmaarb.effect <- 0   #### by keeping the sigmas the same for the microsites (line 76 & 81) we assume that the microclimatic effects are the same across sites
cc.hf <- 4  ## based off weather station data
microhf.effect <- 0
sigma.hf <- 2
microsigmahf.effect <- 0  #### by keeping the sigmas the same for the microsites (line 76 & 81) we assume that the microclimatic effects are the same across sites
#source("simulations/micro_databuildfx.R")
source("simulations/micro_databuildfx_doy.R")
#####And finally... it's modelling time!
if(use.urban==TRUE){
bball$urban <- ifelse(bball$site=="arb", 1, 0)
bball$type <- ifelse(bball$method=="ws", 1, 0)
datalist.gdd <- with(bball,
list(y = gdd,
urban = urban,
method = type,
sp = as.numeric(as.factor(species)),
N = nrow(bball),
n_sp = length(unique(bball$species))
)
)
}
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake <- summary(urbmethod_fake)$summary
urbmethod_fake[grep("mu_", rownames(urbmethod_fake)),]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake)),]
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake <- summary(urbmethod_fake)$summary
urbmethod_fake[grep("mu_", rownames(urbmethod_fake)),]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake)),]
setwd("~/Documents/git/microclimates/analyses/")
#source("source/stan_utility.R")
urb <- read.csv("output/testdata_urbmethod.csv")
#yreal <- urb$gdd
datalist.urb <- with(urb,
list(y = gdd,
tx = urban,
method = method,
sp = as.numeric(as.factor(species)),
N = nrow(urb),
n_sp = length(unique(species))
)
)
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.urb,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
datalist.gdd <- with(urb,
list(y = gdd,
urban = urban,
method = method,
sp = as.numeric(as.factor(species)),
N = nrow(urb),
n_sp = length(unique(species))
)
)
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
datalist.gdd <- with(bball.stan,
list(y = gdd_bb,
urban = urban,
method = method,
sp = as.numeric(as.factor(spp)),
N = nrow(bball.stan),
n_sp = length(unique(bball.stan$spp))
)
)
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake <- summary(urbmethod_fake)$summary
urbmethod_fake[grep("mu_", rownames(urbmethod_fake)),]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake)),]
ws <- read.csv("output/clean_gdd_bbanddvr.csv")
ws$method <- 1
ws_urb <- subset(ws, select=c("id", "type", "gdd_bb", "method", "year", "genus", "species"))
ws_urb <- ws_urb[(ws_urb$type!="Common Garden"),]
ws_urb <- ws_urb[(ws_urb$year=="2019"),]
hobo <- read.csv("output/clean_gdd_bbanddvr_hobo.csv")
hobo$method <- 0
hobo_urb <- subset(hobo, select=c("id", "type", "gdd_bb", "method", "year", "genus", "species"))
hobo_urb <- hobo_urb[(hobo_urb$type!="Common Garden"),]
hobo_urb <- hobo_urb[(hobo_urb$year=="2019"),]
bball <- dplyr::full_join(ws_urb, hobo_urb)
bball$urban <- NA
bball$urban <- ifelse(bball$type=="Harvard Forest", 0, bball$urban)
bball$urban <- ifelse(bball$type=="Treespotters", 1, bball$urban)
bball.stan <- subset(bball, select=c(gdd_bb, urban, method, genus, species))
bball.stan <- bball.stan[(complete.cases(bball.stan)),]
bball.stan <- bball.stan[!is.na(bball.stan$gdd_bb),]
bball.stan$spp <- paste(bball.stan$genus, bball.stan$species, sep="_")
bball.stan <- bball.stan[(bball.stan$gdd_bb<=1000),]
yraw <- bball$gdd_bb
yraw <- na.omit(yraw)
datalist.gdd <- with(bball.stan,
list(y = gdd_bb,
urban = urban,
method = method,
sp = as.numeric(as.factor(spp)),
N = nrow(bball.stan),
n_sp = length(unique(bball.stan$spp))
)
)
urbmethod_fake = stan('stan/urbanmethod_normal_ncp_inter.stan', data = datalist.gdd,
iter = 1000, warmup=500, chains=2)#, control=list(adapt_delta=0.99)) ###
urbmethod_fake <- summary(urbmethod_fake)$summary
urbmethod_fake[grep("mu_", rownames(urbmethod_fake)),]
urbmethod_fake[grep("sigma_", rownames(urbmethod_fake)),]
View(urbmethod_fake)
